<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Louis OLIVE">

<title>Scoring and Logistic Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Scoring_and_Logistic_Regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="Scoring_and_Logistic_Regression_files/libs/quarto-html/quarto.js"></script>
<script src="Scoring_and_Logistic_Regression_files/libs/quarto-html/popper.min.js"></script>
<script src="Scoring_and_Logistic_Regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Scoring_and_Logistic_Regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="Scoring_and_Logistic_Regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Scoring_and_Logistic_Regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Scoring_and_Logistic_Regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Scoring_and_Logistic_Regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Scoring_and_Logistic_Regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script>
  MathJax = {
    tex: {
      tags: 'ams'  // should be 'ams', 'none', or 'all'
    }
  };
</script>

<link href="Scoring_and_Logistic_Regression_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="Scoring_and_Logistic_Regression_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-and-vocabulary" id="toc-introduction-and-vocabulary" class="nav-link active" data-scroll-target="#introduction-and-vocabulary"><span class="header-section-number">1</span> Introduction and vocabulary</a>
  <ul class="collapse">
  <li><a href="#a-reminder-or-not-on-supervised-learning" id="toc-a-reminder-or-not-on-supervised-learning" class="nav-link" data-scroll-target="#a-reminder-or-not-on-supervised-learning"><span class="header-section-number">1.1</span> A reminder (or not) on Supervised Learning</a>
  <ul class="collapse">
  <li><a href="#inputs-outputs" id="toc-inputs-outputs" class="nav-link" data-scroll-target="#inputs-outputs"><span class="header-section-number">1.1.1</span> Inputs-Outputs</a></li>
  <li><a href="#supervised-learning-framework" id="toc-supervised-learning-framework" class="nav-link" data-scroll-target="#supervised-learning-framework"><span class="header-section-number">1.1.2</span> Supervised learning framework</a></li>
  <li><a href="#loss-and-risk" id="toc-loss-and-risk" class="nav-link" data-scroll-target="#loss-and-risk"><span class="header-section-number">1.1.3</span> Loss and Risk</a></li>
  <li><a href="#bayes-classifier" id="toc-bayes-classifier" class="nav-link" data-scroll-target="#bayes-classifier"><span class="header-section-number">1.1.4</span> Bayes classifier</a></li>
  <li><a href="#theory-vs-practice" id="toc-theory-vs-practice" class="nav-link" data-scroll-target="#theory-vs-practice"><span class="header-section-number">1.1.5</span> Theory vs practice</a></li>
  </ul></li>
  <li><a href="#illustrative-example-the-mixture-data-set" id="toc-illustrative-example-the-mixture-data-set" class="nav-link" data-scroll-target="#illustrative-example-the-mixture-data-set"><span class="header-section-number">1.2</span> Illustrative example: the <strong>Mixture</strong> data set</a>
  <ul class="collapse">
  <li><a href="#bayes-classifier-1" id="toc-bayes-classifier-1" class="nav-link" data-scroll-target="#bayes-classifier-1"><span class="header-section-number">1.2.1</span> Bayes classifier</a></li>
  <li><a href="#logistic-regression-classifier" id="toc-logistic-regression-classifier" class="nav-link" data-scroll-target="#logistic-regression-classifier"><span class="header-section-number">1.2.2</span> Logistic Regression classifier</a></li>
  <li><a href="#nonparametric-splines-logistic-regression-classifier" id="toc-nonparametric-splines-logistic-regression-classifier" class="nav-link" data-scroll-target="#nonparametric-splines-logistic-regression-classifier"><span class="header-section-number">1.2.3</span> Nonparametric (splines) Logistic Regression classifier</a></li>
  <li><a href="#logistic-regression-with-binning" id="toc-logistic-regression-with-binning" class="nav-link" data-scroll-target="#logistic-regression-with-binning"><span class="header-section-number">1.2.4</span> Logistic regression with binning:</a></li>
  <li><a href="#k-nearest-neighbors-algorithm" id="toc-k-nearest-neighbors-algorithm" class="nav-link" data-scroll-target="#k-nearest-neighbors-algorithm"><span class="header-section-number">1.2.5</span> K-Nearest Neighbors Algorithm</a></li>
  <li><a href="#decision-trees-cart" id="toc-decision-trees-cart" class="nav-link" data-scroll-target="#decision-trees-cart"><span class="header-section-number">1.2.6</span> Decision Trees (CART)</a></li>
  </ul></li>
  <li><a href="#scoring" id="toc-scoring" class="nav-link" data-scroll-target="#scoring"><span class="header-section-number">1.3</span> Scoring</a></li>
  </ul></li>
  <li><a href="#the-logistic-regression-model" id="toc-the-logistic-regression-model" class="nav-link" data-scroll-target="#the-logistic-regression-model"><span class="header-section-number">2</span> The Logistic Regression model</a>
  <ul class="collapse">
  <li><a href="#informal-introductory-example" id="toc-informal-introductory-example" class="nav-link" data-scroll-target="#informal-introductory-example"><span class="header-section-number">2.1</span> Informal introductory example</a></li>
  <li><a href="#a-more-formal-definition" id="toc-a-more-formal-definition" class="nav-link" data-scroll-target="#a-more-formal-definition"><span class="header-section-number">2.2</span> A more formal definition</a></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">2.3</span> Estimation</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-estimation" id="toc-maximum-likelihood-estimation" class="nav-link" data-scroll-target="#maximum-likelihood-estimation"><span class="header-section-number">2.3.1</span> Maximum Likelihood Estimation</a></li>
  <li><a href="#numerical-methods" id="toc-numerical-methods" class="nav-link" data-scroll-target="#numerical-methods"><span class="header-section-number">2.3.2</span> Numerical methods</a></li>
  <li><a href="#logistic-regression-as-a-machine-learning-approach" id="toc-logistic-regression-as-a-machine-learning-approach" class="nav-link" data-scroll-target="#logistic-regression-as-a-machine-learning-approach"><span class="header-section-number">2.3.3</span> Logistic Regression as a machine learning approach</a></li>
  </ul></li>
  <li><a href="#real-life-data-sets" id="toc-real-life-data-sets" class="nav-link" data-scroll-target="#real-life-data-sets"><span class="header-section-number">2.4</span> Real life data sets</a>
  <ul class="collapse">
  <li><a href="#the-german-credit-data-set" id="toc-the-german-credit-data-set" class="nav-link" data-scroll-target="#the-german-credit-data-set"><span class="header-section-number">2.4.1</span> The <strong>German Credit</strong> data set</a></li>
  <li><a href="#agriculture-farm-lending" id="toc-agriculture-farm-lending" class="nav-link" data-scroll-target="#agriculture-farm-lending"><span class="header-section-number">2.4.2</span> Agriculture Farm Lending</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#roc-curves-partly-inspired-from-exercise-11.10-cornillon2019" id="toc-roc-curves-partly-inspired-from-exercise-11.10-cornillon2019" class="nav-link" data-scroll-target="#roc-curves-partly-inspired-from-exercise-11.10-cornillon2019"><span class="header-section-number">3.1</span> ROC curves (partly inspired from Exercise 11.10 <span class="citation" data-cites="cornillon2019">(Cornillon and Matzner-Løber 2019)</span>)</a></li>
  <li><a href="#bayes-classifier-exercise-11.9-cornillon2019" id="toc-bayes-classifier-exercise-11.9-cornillon2019" class="nav-link" data-scroll-target="#bayes-classifier-exercise-11.9-cornillon2019"><span class="header-section-number">3.2</span> Bayes classifier (Exercise 11.9 <span class="citation" data-cites="cornillon2019">(Cornillon and Matzner-Løber 2019)</span>)</a></li>
  <li><a href="#other-simulated-data-sets" id="toc-other-simulated-data-sets" class="nav-link" data-scroll-target="#other-simulated-data-sets"><span class="header-section-number">3.3</span> Other simulated data sets</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">4</span> References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Scoring and Logistic Regression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Louis OLIVE </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction-and-vocabulary" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction and vocabulary</h1>
<section id="a-reminder-or-not-on-supervised-learning" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="a-reminder-or-not-on-supervised-learning"><span class="header-section-number">1.1</span> A reminder (or not) on Supervised Learning</h2>
<p>This an informal overview of Statistical Learning, where we introduce concepts and definitions. For a rigorous introduction see for example the dedicated lesson from <a href="https://perso.math.univ-toulouse.fr/gadat/files/2012/12/Intro_Stat_Learning.pdf">Sébastien Gadat - D3S M1 course on Mathematical Statistics</a> or <a href="https://www.di.ens.fr/%7Efbach/ltfp_book.pdf">Francis Bach - Learning Theory from First Principles</a>.</p>
<section id="inputs-outputs" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="inputs-outputs"><span class="header-section-number">1.1.1</span> Inputs-Outputs</h3>
<p>We follow here the terminology of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span>. The problem: we are given a data set where some variables, denoted as <strong>inputs</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, have some influence on one or more <strong>output(s)</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>We will denote inputs by the symbol <span class="math inline">\(X\)</span> having values in <span class="math inline">\(\mathrm{X}\)</span> (to explicit things we will consider <span class="math inline">\(\mathrm X\)</span> is <span class="math inline">\(\mathbb R^p\)</span>). If <span class="math inline">\(X\)</span> is a vector, its components can be accessed by subscripts <span class="math inline">\(X_j\)</span>, <span class="math inline">\(j = 1, . . . , p\)</span>.</p>
<p>Outputs will be denoted by <span class="math inline">\(Y\)</span> having value in <span class="math inline">\(\mathrm Y\)</span>:</p>
</section>
<section id="supervised-learning-framework" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="supervised-learning-framework"><span class="header-section-number">1.1.2</span> Supervised learning framework</h3>
<ul>
<li><p>When <span class="math inline">\(\mathrm Y\)</span> is <span class="math inline">\(\mathbb R\)</span>, it is a <strong>regression problem</strong>;</p></li>
<li><p>When <span class="math inline">\(\mathrm Y\)</span> is a discrete set, it is a <strong>classification problem</strong> (for example <span class="math inline">\(\mathrm Y\)</span> is <span class="math inline">\(\{0,1\}\)</span> for binary classification).</p></li>
</ul>
<p>In this course we will restrict to the case of <strong>binary classification</strong>.</p>
<p>We need data to construct predictions or classifications. We suppose we have available a set of observed data:</p>
<p><span class="math inline">\((x_i, y_i) \in \mathrm X \times \mathrm Y\)</span> , <span class="math inline">\(i = 1, \cdots ,n\)</span>, known as the <strong>learning</strong> or <strong>training</strong> set, with which to construct our prediction.</p>
<p>We assume <span class="math inline">\((x_i, y_i) \in \mathrm X \times \mathrm Y\)</span> are generated i.i.d. from:</p>
<p><span class="math display">\[
\mathbf P_{\mathrm X \times \mathrm Y}
\]</span></p>
<p>where we denote <span class="math inline">\(\mathbf P_{\mathrm X \times \mathrm Y}\)</span>, the data generating distribution (or underlying probability distribution or joint law) which is unknown.</p>
<p>The main goal of supervised learning will be to predict unobserved outputs <span class="math inline">\(y\)</span> given unobserved inputs <span class="math inline">\(x\)</span> using the learning set.</p>
<p>Such new or unobserved data is referred as the <strong>testing</strong> set.</p>
</section>
<section id="loss-and-risk" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="loss-and-risk"><span class="header-section-number">1.1.3</span> Loss and Risk</h3>
<p>To achieve that goal we try to find a “best” or optimal <strong>classifier</strong> (or prediction function in general):</p>
<p><span class="math display">\[
f: \mathrm X \to \mathrm Y
\]</span></p>
<p>We first must define some criterion to assess the classifier performance (what is optimal?).</p>
<p>For that purpose we consider a <strong>loss</strong> function <span class="math inline">\(\ell: \mathrm Y \times \mathrm Y \to \mathbb R^+\)</span>:</p>
<p><span class="math display">\[
\left\{ \begin{array}{ll}
    \ell(y,z) &gt; 0 &amp;  \mbox{if } y \neq z\cr
    \ell(y,z) = 0 &amp;  \mbox{if } y = z\cr
\end{array} \right.
\]</span></p>
<p><span class="math inline">\(\ell(y,f(x))\)</span> is the loss or cost of predicting <span class="math inline">\(f(x)\)</span> while the true output is <span class="math inline">\(y\)</span>.</p>
<p>In the context of binary classification a natural selection for loss is the 0-1 loss:</p>
<p><span class="math display">\[
\ell(y,z)=\mathbf 1_{y \neq z}
\]</span></p>
<p>We will see later in the course that other losses are used.</p>
<p>We then define the expected <strong>risk</strong> of a prediction function <span class="math inline">\(f\)</span> given the loss <span class="math inline">\(\ell\)</span> as:</p>
<p><span class="math display">\[
\mathrm R(f) = \mathbb{E}[\ell(Y,f(X))]
\]</span> In the context of binary classification <span class="math inline">\(Y \in \{0,1\}\)</span> and 0-1 loss, we have:</p>
<p><span class="math display">\[
\mathrm R(f) = \mathbb{P}[Y\neq f(X))]
\]</span></p>
<p>Given a data set <span class="math inline">\((x_i, y_i) \in \mathrm X \times \mathrm Y\)</span>, we also define the empirical risk of a classifier <span class="math inline">\(f\)</span> as:</p>
<p><span class="math display">\[
\hat{\mathrm R}(f) = \frac{1}{n} \sum_i \ell(y_i,f(x_i))
\]</span></p>
</section>
<section id="bayes-classifier" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="bayes-classifier"><span class="header-section-number">1.1.4</span> Bayes classifier</h3>
<p>We now define the <strong>Bayes(ian) classifier</strong> <span class="math inline">\(f^*: \mathrm X \to \mathrm Y\)</span> as a function that achieves the minimal expected risk among all possible functions:</p>
<p><span class="math display">\[
\underset{f}{\operatorname{argmin}}\mathrm R(f)
\]</span></p>
<p>It is sometimes designed as oracle in the literature.</p>
<p>The Bayes classifier depends on <span class="math inline">\(\ell\)</span> and <span class="math inline">\(\mathbf P_{\mathrm X \times \mathrm Y}\)</span> which is generally unknown (otherwise the job would be easy).</p>
<p>The Bayes classifier for the 0-1 loss is:</p>
<p><span class="math display">\[
f^*(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } \eta(x)\geq \frac{1}{2}\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\eta(x)=\mathbb{P}[Y=1|X=x)] = \mathbb{E}[Y=1|X=x)]
\]</span></p>
<p><span class="math inline">\(\eta(x)\)</span> is called the regression function.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given <span class="math inline">\(f\)</span> a classifier:</p>
<p>Using 0-1 loss definition:</p>
<p><span class="math display">\[
\begin{align*}
\mathrm R(f)  &amp;= \mathbb{E}_{X,Y}[\ell(Y,f(X))] \\
&amp;=\mathbb{E}_{X,Y}[\mathbf 1_{Y=1} \mathbf 1_{f(X)=0} + \mathbf 1_{Y=0} \mathbf 1_{f(X)=1} ] \\
&amp;= \mathbb{E}_{X}[\mathbb{E}_{Y|X}[\mathbf 1_{Y=1} \mathbf 1_{f(X)=0} + \mathbf 1_{Y=0} \mathbf 1_{f(X)=1}|X]]  \\
\end{align*}
\]</span></p>
<p>Using “Tower Rule” conditioning on <span class="math inline">\(X\)</span> then using <span class="math inline">\(\eta(X)\)</span> definition:</p>
<p><span class="math display">\[
\begin{align*}
&amp;= \mathbb{E}_{X}[\mathbb{E}_{Y|X}[\mathbf 1_{Y=1} \mathbf 1_{f(X)=0} + \mathbf 1_{Y=0} \mathbf 1_{f(X)=1}|X]]  \\
&amp;= \mathbb{E}_{X}[\mathbf 1_{f(X)=0}\mathbb{E}_{Y|X}[\mathbf 1_{Y=1}] + \mathbf 1_{f(X)=1} \mathbb{E}_{Y|X}[\mathbf 1_{Y=0}|X]] \\
&amp;=\mathbb{E}_{X}[\mathbf 1_{f(X)=0}\eta(X) + \mathbf 1_{f(X)=1} (1-\eta(X))] \\
&amp;=\mathbb{E}_{X}[(1-\mathbf 1_{f(X)=1})\eta(X) + \mathbf 1_{f(X)=1} (1-\eta(X))] \\
&amp;=\mathbb{E}_{X}[(\mathbf 1_{f(X)=1}(1-2\eta(X))] + \mathbb{E}_{X}[\eta(X))] \\
\end{align*}
\]</span></p>
<p>To minimize the risk with respect to <span class="math inline">\(f\)</span>:</p>
<ul>
<li><p>if <span class="math inline">\(1-2\eta(X) \leq0\)</span> (ie <span class="math inline">\(\eta(X) \geq \frac{1}{2}\)</span>), we need <span class="math inline">\(f(X)=1\)</span></p></li>
<li><p>if <span class="math inline">\(1-2\eta(X) \geq0\)</span> (ie <span class="math inline">\(\eta(X) \leq \frac{1}{2}\)</span>), we need <span class="math inline">\(f(X)=0\)</span></p></li>
</ul>
<p>It is mostly how was defined <span class="math inline">\(f^*\)</span> before:</p>
<p><span class="math display">\[
f^*(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } \eta(x)\geq \frac{1}{2}\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span></p>
</div>
</div>
</div>
</section>
<section id="theory-vs-practice" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="theory-vs-practice"><span class="header-section-number">1.1.5</span> Theory vs practice</h3>
<p>In practice <span class="math inline">\(\mathbf P_{\mathrm X \times \mathrm Y}\)</span> is unknown. What we have is the learning set. The Bayes classifier minimizes the expected risk but is not a function of the learning set. What to do?</p>
<p>Conceptually two approaches are used<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>:</p>
<ul>
<li><p>the “probabilistic” approach: we estimate the regression function <span class="math inline">\(\eta(x)\)</span> and use/plug this estimate “inside” the Bayes classifier (Plugin); within this approach mainly two sub-approaches:</p>
<ul>
<li><p>the “discriminative” approach or conditional density modeling: we directly model or make an assumption on <span class="math inline">\(\eta(X)=\mathbf P_{\mathrm Y | \mathrm X}\)</span> and estimate it; for example we can make the assumption that <span class="math inline">\(\eta(x)\)</span> is a function of a particular form.</p></li>
<li><p>the “generative” approach: we model the conditional distribution <span class="math inline">\(\mathbf P_{\mathrm X | \mathrm Y}\)</span> and use Bayes formula to get: <span class="math inline">\(\eta(X)=\frac{\mathbb{P}[X|Y=1)]\mathbb{P}[Y=1)]}{\mathbb{P}[X]}=\frac{\mathbb{P}[X|Y=1)]\mathbb{P}[Y=1)]}{\mathbb{P}[X|Y=1)]\mathbb{P}[Y=1)]+\mathbb{P}[X|Y=0)]\mathbb{P}[Y=0)]}\)</span></p></li>
</ul></li>
<li><p>the optimization or “machine learning” approach: finding <span class="math inline">\(f\)</span> minimizing the empirical risk; optimization algorithm or heuristics are used to estimate <span class="math inline">\(f\)</span>; the 0-1 loss is not convex so usually it is replaced by a convex surrogate loss or upper bound; usually re-sampling methods are used to compute empirical risk (<span class="math inline">\(f\)</span> is trained on a training set and empirical risk evaluated on the testing set, <span class="math inline">\(f\)</span> is chosen to minimize empirical risk).</p></li>
</ul>
<p>We will see later that in the context of the Logistic Regression the two approaches are strongly linked: it can be seen as a probabilistic|discriminative approach or a optimization approach.</p>
</section>
</section>
<section id="illustrative-example-the-mixture-data-set" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="illustrative-example-the-mixture-data-set"><span class="header-section-number">1.2</span> Illustrative example: the <strong>Mixture</strong> data set</h2>
<p>To illustrate what we have seen we use the <strong>Mixture</strong> data set described in <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009, 12–16</a>)</span>.</p>
<p>The data set is generated as follows (p.&nbsp;16):</p>
<ul>
<li><p>First the authors generate 10 “means” <span class="math inline">\(m_k\)</span> in <span class="math inline">\(\mathbb R^2\)</span> from a bivariate Gaussian distribution <span class="math inline">\(\mathcal{N}((1,0),I)\)</span> and label this class <em>BLUE</em>.</p></li>
<li><p>Similarly, 10 more are drawn from <span class="math inline">\(\mathcal{N}((0,1),I)\)</span> and labeled <em>ORANGE</em>.</p></li>
<li><p>Then for each class authors generate 100 observations as follows: for each observation, <span class="math inline">\(m_k\)</span> is picked at random with probability <span class="math inline">\(\frac{1}{10}\)</span> and used to generate a <span class="math inline">\(\mathcal{N}(m_k,I/5)\)</span>, thus leading to a mixture of Gaussian clusters for each class. They generate similarly an additional data set of 5k observations per class for testing purposes.</p></li>
</ul>
<p>The task is to create a classifier that, based on the coordinates <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, determines whether the point is <em>ORANGE</em> or <em>BLUE</em>.</p>
<p>First we load the data set and plot the “means”:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated mixture (ORANGE/BLUE) from ESLII/ISLR</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">'../data/mixture.example.RData'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x1_means <span class="ot">&lt;-</span> mixture.example<span class="sc">$</span>means[,<span class="dv">1</span>]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>x2_means <span class="ot">&lt;-</span> mixture.example<span class="sc">$</span>means[,<span class="dv">2</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>mixture_means <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x1_means, x2_means) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(rowid <span class="sc">&lt;=</span> <span class="dv">10</span>, <span class="st">"BLUE"</span>, <span class="st">"ORANGE"</span>))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mixture_means) <span class="sc">+</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span> Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(mixture_means, "mixture_means.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then the training set together with the “means”:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> mixture.example<span class="sc">$</span>y</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> mixture.example<span class="sc">$</span>x[,<span class="dv">1</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> mixture.example<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>data_mixture_example <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Y, x1, x2) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as_factor</span>(Y))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> mixture_means, <span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span>Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(data_mixture_example, "data_mixture_example.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Knowing the generative distribution, we generate a testing set of size 10k (half BLUE, half ORANGE).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate new sampling</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1987</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>draw <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">size=</span>N, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>x1_blue <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">5</span>) <span class="sc">+</span> mixture_means[draw[<span class="dv">1</span><span class="sc">:</span>(N<span class="sc">/</span><span class="dv">2</span>)],<span class="dv">2</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>x2_blue <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">5</span>) <span class="sc">+</span> mixture_means[draw[<span class="dv">1</span><span class="sc">:</span>(N<span class="sc">/</span><span class="dv">2</span>)],<span class="dv">3</span>]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>x1_orange <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">5</span>) <span class="sc">+</span> mixture_means[<span class="dv">10</span> <span class="sc">+</span> draw[(N<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N],<span class="dv">2</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>x2_orange <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">5</span>) <span class="sc">+</span> mixture_means[<span class="dv">10</span> <span class="sc">+</span> draw[(N<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N],<span class="dv">3</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>new_mixture <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(x1_blue, x2_blue, <span class="at">Y=</span><span class="st">"BLUE"</span>), <span class="fu">cbind</span>(x1_orange, x2_orange, <span class="at">Y=</span><span class="st">"ORANGE"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">x1=</span>x1_means, <span class="at">x2=</span>x2_means)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># head(new_mixture)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We plot the first 250 new observations of each class from the generated testing set:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_mixture[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>,<span class="dv">5001</span><span class="sc">:</span><span class="dv">5251</span>),]) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> mixture_means, <span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span>Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(new_mixture, "new_mixture.rds")</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># new_mixture &lt;- readRDS("new_mixture.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="bayes-classifier-1" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="bayes-classifier-1"><span class="header-section-number">1.2.1</span> Bayes classifier</h3>
<p>Knowing the generating distribution we can derive the Bayes classifier (exercise 2.2 <span class="citation" data-cites="hastie2009">(<a href="#ref-hastie2009" role="doc-biblioref">Hastie, Tibshirani, and Friedman 2009</a>)</span>).</p>
<p>We plot the boundary decision in grey:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions/decision boundaries</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction function used to classify areas on the grid and imply the decision boundary</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># explicit expression for the Bayes decision boundary</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>predict_oracle <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2){</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    obj <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>       obj <span class="ot">&lt;-</span> obj <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>((x1<span class="sc">-</span>x1_means[i])<span class="sc">**</span><span class="dv">2</span><span class="sc">+</span>(x2<span class="sc">-</span>x2_means[i])<span class="sc">**</span><span class="dv">2</span>)) <span class="sc">-</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>((x1<span class="sc">-</span>x1_means[i<span class="sc">+</span><span class="dv">10</span>])<span class="sc">**</span><span class="dv">2</span><span class="sc">+</span>(x2<span class="sc">-</span>x2_means[i<span class="sc">+</span><span class="dv">10</span>])<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">*</span> (obj <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>predict_oracle_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(predict_oracle)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> grid_background <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_oracle)),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We estimate Bayes risk on the testing data set simulated before (10k BLUE/ORANGE dots) using the data generating process <span class="math inline">\(\mathbf P_{\mathrm X \times \mathrm Y}\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bayes_error_rate <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_oracle, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>bayes_test_risk <span class="ot">&lt;-</span> bayes_error_rate <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(l01)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>bayes_error_rate_train <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_oracle, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>bayes_train_risk <span class="ot">&lt;-</span> bayes_error_rate_train <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We get a value of 0.213 for the “estimated” Bayes risk, which is in line with <span class="citation" data-cites="hastie2009">(<a href="#ref-hastie2009" role="doc-biblioref">Hastie, Tibshirani, and Friedman 2009, fig. 13.4</a>)</span>, see below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/bayeserror_mixture.png" class="img-fluid figure-img" width="700"></p>
</figure>
</div>
<p>We give below a brief tour showing the decision boundary of common classifiers for the Mixture data set.</p>
</section>
<section id="logistic-regression-classifier" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="logistic-regression-classifier"><span class="header-section-number">1.2.2</span> Logistic Regression classifier</h3>
<p>We plot below the linear decision boundary given by a Logistic Regression vs Bayes, we only display the training set:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions/decision boundaries</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>mixture_example_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_mixture_example, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_logit,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_logit, <span class="at">data =</span> data_mixture_example,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">newdata =</span> grid_background, <span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>))</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>coeffs <span class="ot">&lt;-</span> mixture_example_logit<span class="sc">$</span>coefficients</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>glm_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(x1){</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>(coeffs[<span class="dv">2</span>] <span class="sc">*</span> x1 <span class="sc">+</span> coeffs[<span class="dv">1</span>]) <span class="sc">/</span> coeffs[<span class="dv">3</span>]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>glm_boundary_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(glm_boundary) </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> <span class="fu">glm_boundary</span>(x1)),<span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_glm)),</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We add a sample (500 additional observations for each class) of the testing set to the preceding graph:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions/decision boundaries</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>mixture_example_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_mixture_example, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_logit,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_logit, <span class="at">data =</span> data_mixture_example,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">newdata =</span> grid_background, <span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>))</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>coeffs <span class="ot">&lt;-</span> mixture_example_logit<span class="sc">$</span>coefficients</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>glm_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(x1){</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>(coeffs[<span class="dv">2</span>] <span class="sc">*</span> x1 <span class="sc">+</span> coeffs[<span class="dv">1</span>]) <span class="sc">/</span> coeffs[<span class="dv">3</span>]</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>glm_boundary_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(glm_boundary) </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> <span class="fu">glm_boundary</span>(x1)),<span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_glm)),</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> new_mixture[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="dv">5001</span><span class="sc">:</span><span class="dv">5501</span>),], <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>logit_error_rate <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_logit,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_mixture_example,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> new_mixture,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_glm, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>logit_risk <span class="ot">&lt;-</span> logit_error_rate <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.291.</p>
</section>
<section id="nonparametric-splines-logistic-regression-classifier" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="nonparametric-splines-logistic-regression-classifier"><span class="header-section-number">1.2.3</span> Nonparametric (splines) Logistic Regression classifier</h3>
<p>A popular method to move beyond linearity is to transform variables, for example using splines <span class="citation" data-cites="hastie2009">(<a href="#ref-hastie2009" role="doc-biblioref">Hastie, Tibshirani, and Friedman 2009, 5.6</a> Nonparametric Logistic Regression, p161-164)</span>.</p>
<p>This can achieve more flexibility at the decision boundary.</p>
<p>Using natural splines in <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## fit additive natural cubic spline model</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Natural Cubic Splines - 4 df each (Fig 5.11 p164)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions/decision boundaries</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>mixture_example_glm_splines_add <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">ns</span>(x1, <span class="at">df=</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                                           splines<span class="sc">::</span><span class="fu">ns</span>(x2, <span class="at">df=</span><span class="dv">4</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_splines_add,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">predict_gam =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_splines_add,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid_background,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">predict_gam =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_gam),</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_gam)),</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>logit_splines_add_error_rate <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_splines_add,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_mixture_example,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> new_mixture,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_glm, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>logit_splines_add_risk <span class="ot">&lt;-</span> logit_splines_add_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.29.</p>
<p>Using the interactions of splines in <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## fit additive natural cubic spline model</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Natural Cubic Splines - Tensor Product - 4 df each (Fig 5.11 p164)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions/decision boundaries</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>mixture_example_glm_splines_add_tens <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">ns</span>(x1, <span class="at">df=</span><span class="dv">4</span>) <span class="sc">:</span> <span class="co"># interaction x1/x2</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                                splines<span class="sc">::</span><span class="fu">ns</span>(x2, <span class="at">df=</span><span class="dv">4</span>)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">data =</span> data_mixture_example,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_splines_add_tens,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">predict_gam =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_splines_add_tens,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_mixture_example,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid_background,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">predict_gam =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_gam),</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_gam)),</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>logit_splines_add_tens_error_rate <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_splines_add_tens,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_mixture_example,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> new_mixture,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_glm, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>logit_splines_add_tens_risk <span class="ot">&lt;-</span> logit_splines_add_tens_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.291.</p>
</section>
<section id="logistic-regression-with-binning" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="logistic-regression-with-binning"><span class="header-section-number">1.2.4</span> Logistic regression with binning:</h3>
<p>It is usual, for example in the context of credit scoring or banking, to discretize or categorize numerical variables (a.k.a binning).</p>
<p>Here we use a simple decile binning on <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions/decision boundaries</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>breaks_x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">quantile</span>(data_mixture_example<span class="sc">$</span>x1, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="at">na.rm =</span> T))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>breaks_x1[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1e8</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>breaks_x1[<span class="fu">length</span>(breaks_x1)] <span class="ot">&lt;-</span> <span class="fl">1e8</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>breaks_x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">quantile</span>(data_mixture_example<span class="sc">$</span>x2, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="at">na.rm =</span> T))</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>breaks_x2[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1e8</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>breaks_x2[<span class="fu">length</span>(breaks_x2)] <span class="ot">&lt;-</span> <span class="fl">1e8</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>data_binned <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x1_bin =</span> <span class="fu">cut</span>(x1, <span class="at">breaks =</span> breaks_x1,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">x2_bin =</span> <span class="fu">cut</span>(x2, <span class="at">breaks =</span> breaks_x2,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span> </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x1_bin =</span> <span class="fu">cut</span>(x1, <span class="at">breaks =</span> breaks_x1,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">x2_bin =</span> <span class="fu">cut</span>(x2, <span class="at">breaks =</span> breaks_x2,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> grid_background <span class="sc">%&gt;%</span> </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x1_bin =</span> <span class="fu">cut</span>(x1, <span class="at">breaks =</span> breaks_x1,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">x2_bin =</span> <span class="fu">cut</span>(x2, <span class="at">breaks =</span> breaks_x2,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co"># from https://search.r-project.org/R/refmans/base/html/cut.html</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># x1_labs &lt;- levels(data_binned$x1_bin)</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co"># x2_labs &lt;- levels(data_binned$x2_bin)</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co">#(,] </span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind(lower = as.numeric( sub("\\((.+),.*", "\\1", x1_labs) ),</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co">#       upper = as.numeric( sub("[^,]*,([^]]*)\\]", "\\1", x1_labs) ))</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="co">#[,)</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co"># x1_bounds &lt;- bind_cols(lower = as.numeric( sub("\\[(.+),.*", "\\1", x1_labs) ),</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>                <span class="co"># upper = as.numeric( sub("[^,]*,([^\\)]*)(\\)|])", "\\1", x1_labs) ))</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>mixture_example_glm_binned <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> x1_bin <span class="sc">+</span> x2_bin,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">data =</span> data_binned,</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_binned,</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_binned,</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid,</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">predict_glm_binned =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_binned,</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> data_binned,</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> grid_background,</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">predict_glm_binned =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_glm_binned),</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_glm_binned)),</span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>new_mixture_binned <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x1_bin =</span> <span class="fu">cut</span>(x1, <span class="at">breaks =</span> breaks_x1,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">x2_bin =</span> <span class="fu">cut</span>(x2, <span class="at">breaks =</span> breaks_x2,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dig.lab =</span> <span class="dv">1</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered_result =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>logit_binned_error_rate <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(mixture_example_glm_binned,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_binned,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> new_mixture_binned,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_glm, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>logit_binned_risk <span class="ot">&lt;-</span> logit_binned_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.265.</p>
</section>
<section id="k-nearest-neighbors-algorithm" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="k-nearest-neighbors-algorithm"><span class="header-section-number">1.2.5</span> K-Nearest Neighbors Algorithm</h3>
<p>k-NN is a non-parametric algorithm. Given a new observation, it finds in the training set the k closest points (given a certain distance) and predicts using a majority vote.</p>
<p>We show below the boundary decision for <span class="math inline">\(k=15\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize using boundaries of training sample</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>normalize <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># TRUE (pred error 0.259) / FALSE (pred error 0.2498)</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (normalize) {</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    min1 <span class="ot">&lt;-</span> <span class="fu">min</span>(data_mixture_example<span class="sc">$</span>x1)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    min2 <span class="ot">&lt;-</span> <span class="fu">min</span>(data_mixture_example<span class="sc">$</span>x2)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    max1 <span class="ot">&lt;-</span> <span class="fu">max</span>(data_mixture_example<span class="sc">$</span>x1)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    max2 <span class="ot">&lt;-</span> <span class="fu">max</span>(data_mixture_example<span class="sc">$</span>x2)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    train_mixture <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span> </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x1 =</span> (x1 <span class="sc">-</span> min1) <span class="sc">/</span> (max1 <span class="sc">-</span> min1),</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> (x2 <span class="sc">-</span> min2) <span class="sc">/</span> (max2 <span class="sc">-</span> min2)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1, x2)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    test_grid_mixture <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span> </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x1 =</span> (x1 <span class="sc">-</span> min1) <span class="sc">/</span> (max1 <span class="sc">-</span> min1),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> (x2 <span class="sc">-</span> min2) <span class="sc">/</span> (max2 <span class="sc">-</span> min2)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1, x2)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    test_new_mixture <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span> </span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x1 =</span> (x1 <span class="sc">-</span> min1) <span class="sc">/</span> (max1 <span class="sc">-</span> min1),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> (x2 <span class="sc">-</span> min2) <span class="sc">/</span> (max2 <span class="sc">-</span> min2)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1, x2)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    train_mixture <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1,x2)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For boundary decision (fine grid)</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    test_grid_mixture <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(x1,x2)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For background (coarse grid)</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    background_grid_mixture <span class="ot">&lt;-</span> grid_background <span class="sc">%&gt;%</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(x1,x2)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    test_new_mixture <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1,x2)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>mixture_example_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>                           test_new_mixture, <span class="co"># test X</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>table_test <span class="ot">&lt;-</span> <span class="fu">table</span>(mixture_example_knn,</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>                     new_mixture <span class="sc">%&gt;%</span> <span class="co"># test Y</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as_factor</span>(<span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pull</span>(Y))</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>mixture_example_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>                           train_mixture, <span class="co"># test X = train X</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>table_train <span class="ot">&lt;-</span> <span class="fu">table</span>(mixture_example_knn,</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>      data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y))</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>mixture_example_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>                           test_grid_mixture, <span class="co"># test X = fine grid for boundary plot</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>mixture_example_knn_bg <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>                           background_grid_mixture, <span class="co"># test X = "dotted" grid for plot</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="at">predict_knn =</span> mixture_example_knn) <span class="sc">%&gt;%</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_knn =</span> <span class="fu">if_else</span>(mixture_example_knn<span class="sc">==</span><span class="st">'0'</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid_background, <span class="at">predict_knn =</span> mixture_example_knn_bg) <span class="sc">%&gt;%</span></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_knn =</span> <span class="fu">if_else</span>(mixture_example_knn_bg<span class="sc">==</span><span class="st">'0'</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_knn),</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_knn)),</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>knn_error_rate <span class="ot">&lt;-</span> (table_test[[<span class="dv">2</span>]] <span class="sc">+</span> table_test[[<span class="dv">3</span>]]) <span class="sc">/</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>(table_test[[<span class="dv">1</span>]] <span class="sc">+</span> table_test[[<span class="dv">2</span>]] <span class="sc">+</span> table_test[[<span class="dv">3</span>]] <span class="sc">+</span> table_test[[<span class="dv">4</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.25.</p>
<p>We show below the boundary decision for <span class="math inline">\(k=7\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize using boundaries of training sample</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>normalize <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># TRUE (pred error 0.259) / FALSE (pred error 0.2498)</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (normalize) {</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    min1 <span class="ot">&lt;-</span> <span class="fu">min</span>(data_mixture_example<span class="sc">$</span>x1)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    min2 <span class="ot">&lt;-</span> <span class="fu">min</span>(data_mixture_example<span class="sc">$</span>x2)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    max1 <span class="ot">&lt;-</span> <span class="fu">max</span>(data_mixture_example<span class="sc">$</span>x1)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    max2 <span class="ot">&lt;-</span> <span class="fu">max</span>(data_mixture_example<span class="sc">$</span>x2)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    train_mixture <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x1 =</span> (x1 <span class="sc">-</span> min1) <span class="sc">/</span> (max1 <span class="sc">-</span> min1),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> (x2 <span class="sc">-</span> min2) <span class="sc">/</span> (max2 <span class="sc">-</span> min2)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1, x2)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    test_grid_mixture <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span> </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x1 =</span> (x1 <span class="sc">-</span> min1) <span class="sc">/</span> (max1 <span class="sc">-</span> min1),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> (x2 <span class="sc">-</span> min2) <span class="sc">/</span> (max2 <span class="sc">-</span> min2)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1, x2)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    test_new_mixture <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span> </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x1 =</span> (x1 <span class="sc">-</span> min1) <span class="sc">/</span> (max1 <span class="sc">-</span> min1),</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> (x2 <span class="sc">-</span> min2) <span class="sc">/</span> (max2 <span class="sc">-</span> min2)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1, x2)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    train_mixture <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1,x2)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For boundary decision (fine grid)</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    test_grid_mixture <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(x1,x2)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For background (coarse grid)</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    background_grid_mixture <span class="ot">&lt;-</span> grid_background <span class="sc">%&gt;%</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(x1,x2)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    test_new_mixture <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(x1,x2)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>mixture_example_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>                           test_new_mixture, <span class="co"># test X</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>table_test <span class="ot">&lt;-</span> <span class="fu">table</span>(mixture_example_knn,</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>                     new_mixture <span class="sc">%&gt;%</span> <span class="co"># test Y</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as_factor</span>(<span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pull</span>(Y))</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>mixture_example_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>                           train_mixture, <span class="co"># test X = train X</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>table_train <span class="ot">&lt;-</span> <span class="fu">table</span>(mixture_example_knn,</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>      data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y))</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>mixture_example_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>                           test_grid_mixture, <span class="co"># test X = fine grid for boundary plot</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>mixture_example_knn_bg <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>                           background_grid_mixture, <span class="co"># test X = "dotted" grid for plot</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>                           data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>                           k)</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="at">predict_knn =</span> mixture_example_knn) <span class="sc">%&gt;%</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_knn =</span> <span class="fu">if_else</span>(mixture_example_knn<span class="sc">==</span><span class="st">'0'</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid_background, <span class="at">predict_knn =</span> mixture_example_knn_bg) <span class="sc">%&gt;%</span></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predict_knn =</span> <span class="fu">if_else</span>(mixture_example_knn_bg<span class="sc">==</span><span class="st">'0'</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_knn),</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_knn)),</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>knn_error_rate <span class="ot">&lt;-</span> (table_test[[<span class="dv">2</span>]] <span class="sc">+</span> table_test[[<span class="dv">3</span>]]) <span class="sc">/</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>(table_test[[<span class="dv">1</span>]] <span class="sc">+</span> table_test[[<span class="dv">2</span>]] <span class="sc">+</span> table_test[[<span class="dv">3</span>]] <span class="sc">+</span> table_test[[<span class="dv">4</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.227.</p>
<p>We vary <span class="math inline">\(k\)</span> and show the empirical risks on training and testing sets together with Bayes risk:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">100</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>misclass_curve <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> K){</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    knn_test <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                    test_new_mixture, <span class="co"># test X</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                    data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                    k)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    knn_train <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_mixture, <span class="co">#train X</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                     train_mixture, <span class="co"># test X = train X</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                     data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="co"># train Y</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                     k)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    table_test <span class="ot">&lt;-</span> <span class="fu">table</span>(knn_test,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                        new_mixture <span class="sc">%&gt;%</span> <span class="co"># test Y</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as_factor</span>(<span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pull</span>(Y))</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    test_error <span class="ot">&lt;-</span> (table_test[[<span class="dv">2</span>]] <span class="sc">+</span> table_test[[<span class="dv">3</span>]]) <span class="sc">/</span> </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        (table_test[[<span class="dv">1</span>]] <span class="sc">+</span> table_test[[<span class="dv">2</span>]] <span class="sc">+</span> table_test[[<span class="dv">3</span>]] <span class="sc">+</span> table_test[[<span class="dv">4</span>]])</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    table_train <span class="ot">&lt;-</span> <span class="fu">table</span>(knn_train,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>          data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y))</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    train_error <span class="ot">&lt;-</span> (table_train[[<span class="dv">2</span>]] <span class="sc">+</span> table_train[[<span class="dv">3</span>]]) <span class="sc">/</span> </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        (table_train[[<span class="dv">1</span>]] <span class="sc">+</span> table_train[[<span class="dv">2</span>]] <span class="sc">+</span> table_train[[<span class="dv">3</span>]] <span class="sc">+</span> table_train[[<span class="dv">4</span>]])</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    misclass_curve[[k]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">`</span><span class="at">k - Number of Nearest Neighbours</span><span class="st">`</span> <span class="ot">=</span> k,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">`</span><span class="at">KNN train</span><span class="st">`</span> <span class="ot">=</span> train_error,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">`</span><span class="at">KNN test</span><span class="st">`</span> <span class="ot">=</span> test_error)</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>misclass_plot <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(misclass_curve) <span class="sc">%&gt;%</span> </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Bayes test</span><span class="st">`</span> <span class="ot">=</span> bayes_test_risk,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Bayes train</span><span class="st">`</span> <span class="ot">=</span> bayes_train_risk) <span class="sc">%&gt;%</span> </span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="st">`</span><span class="at">k - Number of Nearest Neighbours</span><span class="st">`</span>,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"Model data"</span>,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"Prediction Error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(misclass_plot) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">k - Number of Nearest Neighbours</span><span class="st">`</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">y =</span> <span class="st">`</span><span class="at">Prediction Error</span><span class="st">`</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Model data</span><span class="st">`</span>))) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">compose_trans</span>(<span class="st">"log10"</span>, <span class="st">"reverse"</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">50</span>, <span class="dv">15</span>, <span class="dv">3</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>)) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">col =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="decision-trees-cart" class="level3" data-number="1.2.6">
<h3 data-number="1.2.6" class="anchored" data-anchor-id="decision-trees-cart"><span class="header-section-number">1.2.6</span> Decision Trees (CART)</h3>
<p>To finish our tour, we show the result of a recursive partition of the plan using Decision Trees techniques:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot) </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fine grid for predictions</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>mixture_example_CART <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_mixture_example, <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as_tibble</span>(<span class="fu">predict</span>(mixture_example_CART, <span class="at">newdata =</span> grid))) <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">0</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="at">predict_CART =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">predict_CART =</span> <span class="dv">1</span><span class="sc">*</span>(predict_CART <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid_background,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">as_tibble</span>(<span class="fu">predict</span>(mixture_example_CART, <span class="at">newdata =</span> grid_background))) <span class="sc">%&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">0</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="at">predict_CART =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">predict_CART =</span> <span class="dv">1</span><span class="sc">*</span>(predict_CART <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># rpart.plot(mixture_example_CART)</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># using nicer low-level function prp to change nodes color / labels etc</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>mixture_example_CART_plot <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>.,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="st">"BLUE"</span>, <span class="st">"ORANGE"</span>)),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(mixture_example_CART_plot, <span class="at">type =</span> <span class="dv">2</span>, <span class="at">extra =</span> <span class="dv">4</span>, <span class="at">fallen.leaves =</span> <span class="cn">TRUE</span>, </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.col =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)[mixture_example_CART<span class="sc">$</span>frame<span class="sc">$</span>yval],</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we indicate both Class 0-1 probabilities and number of observations for each node</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">node.fun =</span> <span class="cf">function</span>(x, labs, digits, varlen) <span class="fu">paste</span>(labs, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">"B/O: "</span>, x<span class="sc">$</span>frame<span class="sc">$</span>yval2[,<span class="dv">2</span>], <span class="st">" - "</span>, x<span class="sc">$</span>frame<span class="sc">$</span>yval2[,<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_CART),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> data_mixture_example, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_CART)),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cart_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict</span>(mixture_example_CART,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">newdata =</span> new_mixture,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">type =</span> <span class="st">"class"</span>)),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">prob =</span> <span class="fu">predict</span>(mixture_example_CART,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">newdata =</span> new_mixture,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#  as_tibble()) %&gt;% </span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>cart_risk <span class="ot">&lt;-</span> cart_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The empirical risk on testing set is 0.247.</p>
<p>To play further and make nicer animated 2D decision boundaries for binary classifiers see these two blogs <a href="https://mathformachines.com/posts/decision/">here</a> and <a href="https://paulvanderlaken.com/2020/01/20/animated-machine-learning-classifiers/">here</a>. Please also note that the <code>scikit-learn</code> <code>Python</code> library implements methods to display <a href="https://scikit-learn.org/stable/modules/generated/sklearn.inspection.DecisionBoundaryDisplay.html">decision boundaries for classifiers</a>.</p>
</section>
</section>
<section id="scoring" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="scoring"><span class="header-section-number">1.3</span> Scoring</h2>
<p>At last we come to the subject of our course!</p>
<p>We remind we are in the context of binary classification.</p>
<p>Often we (and the business) are more interested in estimating the probabilities that <span class="math inline">\(Y\)</span> belongs to each class.</p>
<p>Quoting Trevor Hastie: “For example, it is more valuable to have an estimate of the probability that an insurance claim is fraudulent, than a classification fraudulent or not.” This applies to many uses cases:</p>
<ul>
<li><p>propensity score: is a customer interested by a product or service ? will the user click on the ad?</p></li>
<li><p>behavioral score: may a customer encounter a delinquency, a bankruptcy ?</p></li>
<li><p>application score: is the bank ready to grant a loan or a credit card to a customer to authorize a given transaction ?</p></li>
<li><p>churn score: will a newly acquired customer stay long enough for the account to be profitable ?</p></li>
<li><p>fraud score : is an application or a transaction fraudulent?</p></li>
</ul>
<p>Scoring has business implications and is used as a decision tool for risk assessment or costs reduction:</p>
<ul>
<li><p>improve the rate of return of marketing campaigns : reach more receptive customers without increasing the number of mailings or reach as many receptive customers with smaller mailings</p></li>
<li><p>improve efficiency of credit decisions : treat faster customers with low score and concentrate attention on customers with medium score</p></li>
<li><p>increase homogeneity of decisions across sales managers, and across applications</p></li>
<li><p>reduce the number of overdue</p></li>
<li><p>also used for pricing (adapt price to risk)</p></li>
</ul>
<p>Before teaching this course I understood “Scoring” as applied classification with business perspective (i.e.&nbsp;Credit scoring for banks).</p>
<p>But we will see that this is more subtle than that, and that there is a precise definition of Scoring.</p>
<p>We follow in the rest of the section the terminology of <span class="citation" data-cites="cornillon2019">Cornillon and Matzner-Løber (<a href="#ref-cornillon2019" role="doc-biblioref">2019, chap. 11.6</a> “Prévision - scoring”)</span>.</p>
<p>The aim of Scoring is to find a Scoring function or Score <span class="math inline">\(S: \mathbb R^p \to \mathbb R\)</span> that is “high” in case <span class="math inline">\(\mathbb{P}[Y=1|X=x)\)</span> is “high” and “low” in case <span class="math inline">\(\mathbb{P}[Y=0|X=x)\)</span> is “high”.</p>
<p>We say that <span class="math inline">\(S(x)\)</span> is the score of the observation <span class="math inline">\(x \in \mathbb R^p\)</span>.</p>
<p>We show below a simplified example of a credit scorecard that were typically used by banks to assess the creditworthiness of consumer loans applicants (as shown in <span class="citation" data-cites="scoringThomas">(<a href="#ref-scoringThomas" role="doc-biblioref">Thomas, Edelman, and Crook 2002</a>)</span>):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/scoring_scorecard.png" class="img-fluid figure-img" width="350"></p>
</figure>
</div>
<p>In this example a 35-year-old owner wishing to borrow money for home improvement and that has never had a county court judgement (CCJ) will score <span class="math inline">\(129 = (36+25+36+32)\)</span>, while a 20-year-old living with his parents borrowing for holiday and having more than £1200 of CCJ will score <span class="math inline">\(38=(22+14+19-17)\)</span>.</p>
<p>Some remarks:</p>
<ul>
<li>the notions of Score and classifier are closely linked. Given a Score <span class="math inline">\(S\)</span> and a cutoff <span class="math inline">\(s \in \mathbb R\)</span> we obtain the following classifier:</li>
</ul>
<p><span class="math display">\[
f_s(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } S(x)\geq s\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span></p>
<ul>
<li><p>The values taken by <span class="math inline">\(S(x)\)</span> are less important than the way they will order a set of observation <span class="math inline">\(x_1,...x_n\)</span>. For any <span class="math inline">\(\phi: \mathbb R \to \mathbb R\)</span> bijective and increasing function, we say that the scores <span class="math inline">\(S\)</span> and <span class="math inline">\(\phi \circ S\)</span> are equivalent.</p></li>
<li><p>We defined above, in the context of supervised learning, the regression function <span class="math inline">\(\eta(x)=\mathbb{P}[Y=1|X=x)]\)</span>. It is a natural candidate for a Scoring function. The related Bayes classifier uses <span class="math inline">\(s=\frac{1}{2}\)</span> as cutoff. As we have just seen in the last sections, <span class="math inline">\(\eta(x)\)</span> is unknown and we will have to approximate or estimate this regression function using the training set.</p></li>
</ul>
<p>There are many ways to assess the performance of a Score.</p>
<p>We first define the <strong>confusion matrix</strong>:</p>
<table class="table-bordered table">
<caption></caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;"><span class="math inline">\(f_s(X)=0\)</span></th>
<th style="text-align: center;"><span class="math inline">\(f_s(X)=1\)</span></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(Y=0\)</span></td>
<td style="text-align: center;">TN</td>
<td style="text-align: center;">FP</td>
<td style="text-align: center;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(Y=1\)</span></td>
<td style="text-align: center;">FN</td>
<td style="text-align: center;">TP</td>
<td style="text-align: center;">P</td>
</tr>
</tbody>
</table>
<p>The <a href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a> is a contingency table which cross-tabulates <span class="math inline">\(Y\)</span> with the predicted one <span class="math inline">\(f_s(X)\)</span>.</p>
<p>It can be evaluated on the learning set as well as on the testing set.</p>
<p>The following vocabulary originates from medical applications:</p>
<ul>
<li><p>true positive (TP)</p></li>
<li><p>true negative (TN),</p></li>
<li><p>false positive (FP), also Type I error</p></li>
<li><p>false negative (FN), also Type II error</p></li>
</ul>
<p>More formally we define for a given cutoff <span class="math inline">\(s\)</span>:</p>
<p><span class="math display">\[
\alpha(s)=\mathbf P(f_s(X)=1|Y=0)=P(S(X) \geq s|Y=0)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\beta(s)=\mathbf P(f_s(X)=0|Y=1)=P(S(X) &lt; s|Y=1)
\]</span></p>
<p><span class="math inline">\(\alpha(s)\)</span> is called <strong>false positive</strong> rate and <span class="math inline">\(\beta(s)\)</span> <strong>false negative</strong> rate. Similarly <strong>specificity</strong> and <strong>sensitivity</strong> are defined:</p>
<p><span class="math display">\[
sp(s)=P(S(X) &lt; s|Y=0) = 1 - \alpha(s)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
se(s)=P(S(X) \geq s|Y=1) = 1 - \beta(s)
\]</span></p>
<p>The ROC (Receiver Operating Characteristic) curve allows to visualize <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> on a same graph for all <span class="math inline">\(s\)</span> allowing to choose the cutoff and compare different Scores.</p>
<p>Precisely, the ROC curve of a Score <span class="math inline">\(S\)</span> is a parametric curve of the variable <span class="math inline">\(s\)</span>:</p>
<p><span class="math display">\[
\begin{array}{ll}
    ROC:&amp;\mathbb R \to [0,1]^2 \cr
        &amp; s \to (x(s)=\alpha(s),y(s)=1-\beta(s))\cr
\end{array}
\]</span></p>
<p>For a given Score <span class="math inline">\(S\)</span>, the ROC curve passes through the points <span class="math inline">\((0,0)\)</span> and <span class="math inline">\((1,1)\)</span>, which corresponds to classifying all observations as <span class="math inline">\(0\)</span> (<span class="math inline">\(s\to \infty\)</span>) or <span class="math inline">\(1\)</span> (<span class="math inline">\(s\to -\infty\)</span>).</p>
<p>We now define two special cases:</p>
<p>A Score <span class="math inline">\(S\)</span> is said to be <strong>perfect</strong> if <span class="math inline">\(s^*\)</span> exists such that:</p>
<p><span class="math display">\[
P(Y=1|S(X) \geq s^*) = 1
\]</span> and <span class="math display">\[
P(Y=0|S(X) &lt; s^*) = 1
\]</span></p>
<p>It corresponds to <span class="math inline">\(x(s^*)=0\)</span> and <span class="math inline">\(y(s^*)=1\)</span> (using the preceding definitions and Bayes rule).</p>
<p>For example:</p>
<p><span class="math display">\[
x(s^*)=P(S(X) \geq s^*|Y=0)=\frac{P(Y=0|S(X) \geq s^*)P(S(X) \geq s^*)}{P(Y=0)}=0
\]</span></p>
<p>Similarly: for <span class="math inline">\(s \leq s^*\)</span> we have <span class="math inline">\(x(s)=0\)</span> and for <span class="math inline">\(s &gt; s^*\)</span> we have <span class="math inline">\(y(s)=1\)</span>.</p>
<p>A score <span class="math inline">\(S\)</span> is said to be <strong>random</strong> if <span class="math inline">\(S(X)\)</span> and <span class="math inline">\(Y\)</span> are independent. In such case:</p>
<p><span class="math display">\[
x(s)=P(S(X) \geq s|Y=0)=P(S(X))=P(S(X) \geq s|Y=1)=y(s)
\]</span></p>
<p>The ROC curve for a random score is the first bisector <span class="math inline">\((0,0)\)</span> to <span class="math inline">\((1,1)\)</span>.</p>
<p><a href="#fig-roc-perfect-random">Figure&nbsp;1</a> shows the two curves.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>perfect_score_label <span class="ot">=</span> <span class="st">"s=s^{</span><span class="sc">\\</span><span class="st">*}"</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="st">"s="</span><span class="sc">~</span>rho <span class="sc">==</span> <span class="fl">0.34</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>), <span class="at">col=</span><span class="st">"dodgerblue"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># perfect score vert</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">1</span>), <span class="at">col=</span><span class="st">"dodgerblue"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># perfect score horiz</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">1</span>), <span class="at">col=</span><span class="st">"orange"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span> <span class="co"># random score</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate perfect score</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.95</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.02</span>, <span class="st">"npc"</span>))) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">0.08</span>,<span class="at">y=</span><span class="fl">0.92</span>, <span class="at">label =</span> <span class="st">'s == "s*"'</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -Inf</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">y =</span> <span class="fl">0.95</span>, <span class="at">xend =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">1</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.02</span>, <span class="st">"npc"</span>)))<span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">0.92</span>,<span class="at">y=</span><span class="fl">0.92</span>, <span class="at">label =</span> <span class="fu">expression</span>(s<span class="sc">==-</span>infinity), <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># +Inf</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.02</span>, <span class="st">"npc"</span>)))<span class="sc">+</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span><span class="fl">0.08</span>,<span class="at">y=</span><span class="fl">0.08</span>, <span class="at">label =</span> <span class="fu">expression</span>(s<span class="sc">==</span>infinity), <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"false positives"</span>, <span class="at">y =</span> <span class="st">"true positives"</span>) <span class="sc">+</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-roc-perfect-random" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/fig-roc-perfect-random-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: ROC curves of a perfect Score (solid, blue) and a random Score (dashed, orange)</figcaption>
</figure>
</div>
</div>
</div>
<p>The ROC curves can be summarized to generate numeric criteria such as the AUC (Area Under Curve).</p>
<p>The AUC will be <span class="math inline">\(1\)</span> for the perfect Score and <span class="math inline">\(0.5\)</span> for the random Score and can be used to rapidly compare two Scores.</p>
<p>It is considered better than other point-wise criteria.</p>
<p>However we must keep in mind that the AUC as a summary criterion presents some drawbacks since two Scores can have the same AUC but behave very differently in the plane.</p>
<p>In practice we do not know the probabilities <span class="math inline">\(x(s)\)</span> and <span class="math inline">\(y(s)\)</span> to define the ROC curve.</p>
<p>As said before, a training set will be used to learn a Score <span class="math inline">\(S\)</span> and a testing set to estimate the ROC curve <span class="math inline">\(x(s)\)</span> and <span class="math inline">\(y(s)\)</span> for a range of <span class="math inline">\(s\)</span>.</p>
<p>In the rest of the course we will be equally interested in binary classification and scoring which are closely linked.</p>
<p>Throughout the course, we will focus on two fundamental and complementary models: the Logistic Regression model and Decision Trees.</p>
<p>Logistic Regression adopts a “probabilistic|discriminative” approach to model with a parametric law the conditional probability <span class="math inline">\(Y|X\)</span> and then estimate the parameters of the regression function.</p>
<p>On the other hand, Decision Trees adopt a “machine learning” approach, aiming to minimize empirical risk.</p>
<p>These two models serve as the foundation elements for modern machine learning algorithm, making them essential components of the classification/scoring toolkit.</p>
<p>Moreover these two methods can be combined, see for example this <a href="https://techblog.criteo.com/unity-is-strength-a-story-of-model-composition-49748b1f1347">2020 blog post from Criteo engineering team on combining Logistic Regression and Decision Trees in production</a>.</p>
</section>
</section>
<section id="the-logistic-regression-model" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The Logistic Regression model</h1>
<section id="informal-introductory-example" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="informal-introductory-example"><span class="header-section-number">2.1</span> Informal introductory example</h2>
<p>We provide here some intuitions leading to the Logistic Regression model using a simulated data set from <span class="citation" data-cites="islr2021">James et al. (<a href="#ref-islr2021" role="doc-biblioref">2021</a>)</span> (the <strong>Default</strong> data set).</p>
<p>This is a toy data set used for teaching purposes containing information on ten thousand customers.</p>
<p>The aim here is to assess which customers will <strong><em>default</em></strong> on their credit card debt (the target or response variable) based on the current credit card <strong><em>balance</em></strong> and other individual characteristics (the predictors or feature vector).</p>
<p>This is a binary classification problem as the <strong><em>default</em></strong> variable takes value in a discrete set (here binary). In the following we will denote <span class="math inline">\(Y\)</span> the output or response variable and <span class="math inline">\(X = (X_0,X_1,\cdots,X_{p-1})^{T}\)</span> the feature vector or inputs.</p>
<p>The approach we follow is similar to <span class="citation" data-cites="hosmer2013">(<a href="#ref-hosmer2013" role="doc-biblioref">Hosmer, Lemeshow, and Sturdivant 2013</a>)</span> or <span class="citation" data-cites="cornillon2019">(<a href="#ref-cornillon2019" role="doc-biblioref">Cornillon and Matzner-Løber 2019</a>)</span>. Both books use a similar example: the presence or absence of a Coronary Heart Disease (CHD) is explained with the age of an individual (the data set <em>chdage</em> is available in companion package <em>aplore3</em>).</p>
<p>We can start to explore the Default data with a scatterplot (<a href="#fig-default_balance-scatterplot">Figure&nbsp;2</a>) of the target variable (<strong><em>default</em></strong>) with respect to a predictor (<strong><em>balance</em></strong>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Default data set (simulated) from ESLII/ISLR</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>default_data <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Default <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(default_data, <span class="fu">aes</span>(<span class="at">x=</span>balance, <span class="at">y=</span>default)) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-default_balance-scatterplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/fig-default_balance-scatterplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Scatterplot of variable <strong><em>default</em></strong> with respect to credit card <strong><em>balance</em></strong> for 10000 customers</figcaption>
</figure>
</div>
</div>
</div>
<p>In this scatterplot, all points fall on one of two parallel lines representing the absence (No) or occurrence (Yes) of <strong><em>default</em></strong>. We “jitter” the data vertically to avoid overplotting. The plot below shows that the response variable is imbalanced towards the absence of default:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(default_data, <span class="fu">aes</span>(<span class="at">x=</span>balance, <span class="at">y=</span>default)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">height=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We also show the boxplots of credit cards <strong><em>balance</em></strong> with respect to <strong><em>default</em></strong> status:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(default_data,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>default, <span class="at">y=</span>balance)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-balance_default-boxplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/fig-balance_default-boxplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Variable <strong><em>balance</em></strong> with respect to <strong><em>default</em></strong> status</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see from <a href="#fig-default_balance-scatterplot">Figure&nbsp;2</a> and <a href="#fig-balance_default-boxplot">Figure&nbsp;3</a> that default tends to be more prevalent for accounts with a high balance. However it is difficult to guess a simple relationship between default and balance.</p>
<p>To investigate further we discretise the balance variables by classes of width <span class="math inline">\(300\$\)</span> and compute the mean of response variable (<strong><em>default</em></strong> is Yes) within each balance class:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>class_width <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>(default_data_binned <span class="ot">&lt;-</span> default_data <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">balance_bins =</span> <span class="fu">cut</span>(balance, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3000</span>, class_width),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">right =</span> <span class="cn">FALSE</span>, <span class="at">dig.lab =</span> <span class="dv">4</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">floor</span>(balance <span class="sc">/</span> class_width) <span class="sc">*</span> class_width,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">if_else</span>(balance <span class="sc">==</span> <span class="dv">0</span> , <span class="dv">1</span>, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># customers with 0$ balance should be long to [0, width) class</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># or be excluded</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ceiling</span>(balance <span class="sc">/</span> class_width))  <span class="sc">*</span> class_width) <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(balance_bins, min, max, default) <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> default, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">Yes =</span> <span class="dv">0</span>, <span class="at">No =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(Yes <span class="sc">/</span> (Yes <span class="sc">+</span> No), <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["balance_bins"],"name":[1],"type":["fct"],"align":["left"]},{"label":["min"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["max"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["No"],"name":[4],"type":["int"],"align":["right"]},{"label":["Yes"],"name":[5],"type":["int"],"align":["right"]},{"label":["Mean(default)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"[0,300)","2":"0","3":"300","4":"1497","5":"0","6":"0.0000"},{"1":"[300,600)","2":"300","3":"600","4":"1784","5":"0","6":"0.0000"},{"1":"[600,900)","2":"600","3":"900","4":"2305","5":"3","6":"0.0013"},{"1":"[900,1200)","2":"900","3":"1200","4":"2098","5":"19","6":"0.0090"},{"1":"[1200,1500)","2":"1200","3":"1500","4":"1330","5":"53","6":"0.0383"},{"1":"[1500,1800)","2":"1500","3":"1800","4":"527","5":"96","6":"0.1541"},{"1":"[1800,2100)","2":"1800","3":"2100","4":"115","5":"114","6":"0.4978"},{"1":"[2100,2400)","2":"2100","3":"2400","4":"11","5":"41","6":"0.7885"},{"1":"[2400,2700)","2":"2400","3":"2700","4":"0","5":"7","6":"1.0000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In the following we map, by convention and for better readability, the response variable <span class="math inline">\(Y \in\{Yes, No\}\)</span> to <span class="math inline">\(\{0, 1\}\)</span>:</p>
<p><span class="math display">\[
Y = \left\{ \begin{array}{ll}
    1&amp;  \mbox{if customer defaulted on its credit card (ie default=Yes)}\cr
    0&amp;  \mbox{otherwise}.
    \end{array} \right.
\]</span></p>
<p>Then we plot the mean of default (in red) within each balance class (of width <span class="math inline">\(300\$\)</span>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(default_occurrence <span class="ot">&lt;-</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(default_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">default =</span> <span class="fu">if_else</span>(default <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)), <span class="fu">aes</span>(<span class="at">x=</span>balance, <span class="at">y=</span>default)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_segment</span>(<span class="at">data =</span> default_data_binned,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> min, <span class="at">xend =</span> max, <span class="at">y =</span> <span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">'coral'</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth=</span><span class="fl">1.25</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-balance_default-scatterplot-occurrence" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/fig-balance_default-scatterplot-occurrence-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Mean occurrence of <strong><em>default</em></strong> within <strong><em>balance</em></strong> classes</figcaption>
</figure>
</div>
</div>
</div>
<p>The relationship between the mean occurrence of <strong><em>default</em></strong> and <strong><em>balance</em></strong> is easier to read.</p>
<p><a href="#fig-balance_default-scatterplot-occurrence">Figure&nbsp;4</a> clearly shows that as balance increases, the proportion of customers defaulting on their credit card increases.</p>
<p>We also notice that the mean default occurrence with respect to balance classes follows a kind of “S”-shaped curve or <strong>sigmoid</strong> function. Note that the shape depends on classes width and might change.</p>
<p>Going further and informally, considering that the mean of default occurrence is an estimate of <span class="math inline">\(\mathbf{E}[Y|X=x]\)</span> for each balance classes an idea would be to model:</p>
<p><span class="math display">\[
\mathbb{E}[Y|X=x] = \mu_\beta(x)
\]</span></p>
<p>where <span class="math inline">\(\mu_\beta\)</span> is a <strong>sigmoid</strong> function in <span class="math inline">\([0,1]\)</span>.</p>
<p>The Logistic Regression model uses the <strong>sigmoid</strong> function <span class="math inline">\(\sigma: x \to\sigma(x)=\frac{e^{x}} { 1 + e^{x} }\)</span> also known as logistic function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(default_occurrence <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>), </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">"dodgerblue"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_segment</span>(<span class="at">data =</span> default_data_binned,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> min, <span class="at">xend =</span> max, <span class="at">y =</span> <span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">'coral'</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth=</span><span class="fl">1.25</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Another approach would have been to treat <span class="math inline">\(Y\)</span> as a quantitative response variable and fit a simple linear model:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(default <span class="sc">~</span> balance, <span class="at">data =</span> default_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">default =</span> <span class="fu">if_else</span>(default <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(linear)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>coeff_lm <span class="ot">&lt;-</span> linear<span class="sc">$</span>coefficients</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> coeff_lm[<span class="st">"(Intercept)"</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> coeff_lm[<span class="st">"balance"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(default_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">default =</span> <span class="fu">if_else</span>(default <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)), <span class="fu">aes</span>(<span class="at">x=</span>balance, <span class="at">y=</span>default)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_segment</span>(<span class="at">data =</span> default_data_binned,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> min, <span class="at">xend =</span> max, <span class="at">y =</span> <span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">Mean(default)</span><span class="st">`</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">'coral'</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="fl">1.25</span>)<span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">3000</span>, <span class="dv">300</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">y =</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> x),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">'darkolivegreen'</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">linetype =</span> <span class="st">'dotted'</span>))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Alternatively we could have used the geom_smooth command</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_smooth(method = "lm", </span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a> <span class="co">#             formula = y ~ x,</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a> <span class="co">#             se = FALSE,</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a> <span class="co">#             col = "darkolivegreen",</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a> <span class="co">#             linetype = "dotted")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-balance_default-scatterplot-lmfit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/fig-balance_default-scatterplot-lmfit-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Fitting a linear model, <strong><em>default</em></strong> is treated as a quantitative response variable</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-balance_default-scatterplot-lmfit">Figure&nbsp;5</a> shows that a linear model fails to fit the data. In particular, for low credit card balances the linear model shows a “negative probability of default”. This is quite prominent here as response variable is imbalanced towards the No default category. For the same reasons, the least square method fails to correctly fit the category of interest (less than 0.25 probability).</p>
<p>Usually in such presentation (for example <span class="citation" data-cites="hosmer2013">Hosmer, Lemeshow, and Sturdivant (<a href="#ref-hosmer2013" role="doc-biblioref">2013</a>)</span>) data is more balanced and a linear model approximately fits the two classes. However in any case a linear model cannot confine the predicted value to <span class="math inline">\([0, 1]\)</span> for all observations of predictors.</p>
</section>
<section id="a-more-formal-definition" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="a-more-formal-definition"><span class="header-section-number">2.2</span> A more formal definition</h2>
<p>We use the concepts we have defined in the first part of this lesson. The problem we are facing trying to predict the output default (<span class="math inline">\(Y \in \{0,1\}\)</span>) using a training set of inputs or feature vector <span class="math inline">\(X\)</span> is a binary classification problem.</p>
<p>We remind that to estimate an optimal classifier for output <span class="math inline">\(Y \in \{0,1\}\)</span> using input <span class="math inline">\(X = (X_1,\cdots,X_p)\)</span> one approach was to:</p>
<ul>
<li><p>model the conditional distribution <span class="math inline">\(Y|X\)</span>,</p></li>
<li><p>estimate <span class="math inline">\(\eta(x)\)</span> with:</p></li>
</ul>
<p><span class="math display">\[
\eta(x)=\mathbb{P}[Y=1|X=x)] = \mathbb{E}[Y=1|X=x)]
\]</span></p>
<ul>
<li><p><span class="math inline">\(\eta(x)\)</span> can be used as a Scoring function (ROC curve, choice of cutoff <span class="math inline">\(s\)</span>)</p></li>
<li><p>and we can use the classifier (usually <span class="math inline">\(s=\frac{1}{2}\)</span>) to predict output <span class="math inline">\(Y\)</span>:</p></li>
</ul>
<p><span class="math display">\[
f_s(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } \eta(x)\geq s\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span></p>
<p>In the case of <strong>Logistic Regression</strong> classifier, we model:</p>
<p><span class="math display">\[
Y|X=x~ \sim B(\eta(x))
\]</span></p>
<p>with</p>
<p><span class="math display">\[
\eta(x)=\sigma(x^T\beta) =\frac{exp(x^T\beta)}{1+exp(x^T\beta)}
\]</span></p>
<p>for some parameter <span class="math inline">\(\beta=(\beta_1,\cdots,\beta_p)\in \mathbb R^p\)</span>, usually <span class="math inline">\(x_1=1\)</span> and <span class="math inline">\(\beta_1\)</span> is an intercept. <span class="math inline">\(\sigma\)</span> is the sigmoid logistic function we have seen before.</p>
<p>In the literature is usual to denote <span class="math inline">\(\eta(X)=p_{\beta}(X)\)</span> or <span class="math inline">\(\eta(X)=\pi_{\beta}(X)\)</span>.</p>
<p>From now, we will use the notation <span class="math inline">\(p_{\beta}(X)\)</span>.</p>
<p>Defining <span class="math inline">\(\mathrm{logit}: x \to \log\bigg( \frac{x}{1-x}\bigg)\)</span> we have:</p>
<p><span class="math display">\[
\mathrm{logit}(p_{\beta}(X))=X^T\beta
\]</span></p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The <strong>Logistic Regression</strong> model:
</div>
</div>
<div class="callout-body-container callout-body">
<p>We are given <span class="math inline">\((x_i, y_i) \in \mathbb R^p \times \{0,1\}\)</span>, <span class="math inline">\(i=1,\cdots,n\)</span></p>
<p>The Logistic Regression model assumes that outputs <span class="math inline">\(y_i\)</span> are independent Bernoulli with parameter <span class="math inline">\(p_{\beta}(x_i)\)</span> depending on <span class="math inline">\(x_i\)</span>:</p>
<p><span class="math display">\[
\mathrm{logit}(p_{\beta}(x_i))=x_i^T\beta
\]</span></p>
</div>
</div>
<p>The Logistic Regression model defined above is a special case of more general family of models, the so-called Generalized Linear Models (GLM).</p>
<p>The family of GLM extends the applicability of linear-model ideas to data where responses are binary (e.g.&nbsp;Logistic Regression) or counts (e.g.&nbsp;Poisson Regression), among further possibilities. The concept emerged with Nelder and Wedderburn and has been studied extensively (see <span class="citation" data-cites="nelder1972">Nelder and Wedderburn (<a href="#ref-nelder1972" role="doc-biblioref">1972</a>)</span> or <span class="citation" data-cites="cornillon2019">Cornillon and Matzner-Løber (<a href="#ref-cornillon2019" role="doc-biblioref">2019</a>)</span>) .</p>
<p>The syntax to fit the Logistic model in R using <code>glm()</code> is:</p>
<p><span class="math display">\[
\mathtt{glm(} \mathrm{y} \sim \mathrm{~x,~}\mathtt{data=}~\mathrm{dataframe,~}\mathtt{family~=~binomial(link~=~"logit")}
\]</span></p>
<p>The formula <span class="math inline">\(\mathrm{y} \sim \mathrm{x}\)</span> depicts the model (i.e.&nbsp;inputs are <span class="math inline">\(X\)</span>, output is <span class="math inline">\(Y\)</span>) and the <code>data=</code> argument points to the training set contained in a R dataframe (or tibble). This is quite similar to the <code>lm()</code> function.</p>
<p>We also need to specify the distribution for the conditional <span class="math inline">\(Y\)</span> values (binomial) and the link function (logit) via the <code>family=</code> argument.</p>
<p>For our example:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>glm_default <span class="ot">&lt;-</span> <span class="fu">glm</span>(default <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> student <span class="sc">+</span> balance <span class="sc">+</span> income,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> default_data,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>glm_default <span class="ot">&lt;-</span> <span class="fu">glm</span>(default <span class="sc">~</span> .,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> default_data,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">"binomial"</span>) <span class="co"># by default: link = "logit"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The command <code>summary</code> produces result summaries of the fitted model:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = default ~ ., family = "binomial", data = default_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.087e+01  4.923e-01 -22.080  &lt; 2e-16 ***
studentYes  -6.468e-01  2.363e-01  -2.738  0.00619 ** 
balance      5.737e-03  2.319e-04  24.738  &lt; 2e-16 ***
income       3.033e-06  8.203e-06   0.370  0.71152    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2920.6  on 9999  degrees of freedom
Residual deviance: 1571.5  on 9996  degrees of freedom
AIC: 1579.5

Number of Fisher Scoring iterations: 8</code></pre>
</div>
</div>
<p>We will see later how to interpret or understand what is printed</p>
<p>A coefficient-wise output of the model can be obtained as a <code>tibble</code> using <code>tidy()</code> from package <code>broom</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(glm_default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"-1.086905e+01","3":"4.922555e-01","4":"-22.080088","5":"4.911280e-108"},{"1":"studentYes","2":"-6.467758e-01","3":"2.362525e-01","4":"-2.737646","5":"6.188063e-03"},{"1":"balance","2":"5.736505e-03","3":"2.318945e-04","4":"24.737563","5":"4.219578e-135"},{"1":"income","2":"3.033450e-06","3":"8.202615e-06","4":"0.369815","5":"7.115203e-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Based on this output, the fitted model is (we have re-scaled balance and income for better readability):</p>
<p><span class="math display">\[
\log \bigg( \frac{p_{\beta}(x_i)}{1 - p_{\beta}(x_i)}\bigg) = -1.09 - 0.65(\mathbb{1}_{\mathrm{student}_i=\mathrm{Yes}}) + 5.74(\frac{\mathrm{balance}_i}{1000})+ 0.03(\frac{\mathrm{income}_i}{10000})
\]</span></p>
</section>
<section id="estimation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="estimation"><span class="header-section-number">2.3</span> Estimation</h2>
<section id="maximum-likelihood-estimation" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="maximum-likelihood-estimation"><span class="header-section-number">2.3.1</span> Maximum Likelihood Estimation</h3>
<p>We are given <span class="math inline">\((x_i, y_i) \in \mathbb R^p \times \{0,1\}\)</span>, <span class="math inline">\(i=1,\cdots,n\)</span> where outputs <span class="math inline">\(y_i\)</span> are independent Bernoulli with parameter <span class="math inline">\(p_{\beta}(x_i)\)</span> depending on <span class="math inline">\(x_i\)</span>:</p>
<p><span class="math display">\[
\mathrm{logit}(p_{\beta}(x_i))=x_i^T\beta
\]</span></p>
<p>The parameters <span class="math inline">\(\beta\)</span> of the Logistic Regression model are usually determined using Maximum Likelihood Estimation (MLE). It consists on finding <span class="math inline">\(\beta\)</span> for which the joint probability of the observed data is greatest.</p>
<p>As <span class="math inline">\(y_i\)</span> are independent, the likelihood function (joint probability) is the product of the probability mass functions:</p>
<p><span class="math display">\[
L(Y,\beta) = \prod_{i=1}^n p_{\beta}(x_i)^{y_i}(1-p_{\beta}(x_i))^{1-y_i}
\]</span> with <span class="math inline">\(Y=(y_1,\cdots,y_n)\)</span> and <span class="math inline">\(\beta=(\beta_1,\cdots,\beta_p)\)</span>.</p>
<p>We seek to maximize the likelihood function over <span class="math inline">\(\beta\)</span>, it is equivalent but easier to maximize the log-likelihood:</p>
<p><span class="math display">\[
\begin{align}
\ell(Y,\beta)=\log L(Y,\beta) &amp;=\sum_{i=1}^n \left(y_i \log(p_{\beta}(x_i))+(1-y_i) \log(1- p_{\beta}(x_i))\right) \\
                              &amp;=\sum_{i=1}^{n} \left(y_i \log(\frac{p_{\beta}(x_i)}{1-p_{\beta}(x_i)})+\log(1- p_{\beta}(x_i))\right) \\
                              &amp;=\sum_{i=1}^{n} \left(y_i x_i^T\beta -\log(1 + \exp(x_i^T\beta)\right)
\end{align}
\]</span></p>
<p>If the MLE <span class="math inline">\(\hat\beta\)</span> exists, the gradient of log-likelihood satisfies (first order necessary condition):</p>
<p><span class="math display">\[
\nabla\ell(Y,\beta)=\left(\frac{\partial \ell(Y,\beta)}{\partial \beta_1}, \cdots,\frac{\partial \ell(Y,\beta)}{\partial \beta_p}\right)=\mathbf 0
\]</span></p>
<p>We have for <span class="math inline">\(j=1,\cdots,p\)</span>:</p>
<p><span class="math display">\[
\frac{\partial \ell(Y,\beta)}{\partial \beta_j}=\sum_{i=1}^{n} \left(y_i x_{ij} -x_{ij}\frac{\exp(x_i^T\beta)}{1+\exp(x_i^T\beta)}\right)=\sum_{i=1}^{n} x_{ij} \left(y_i- p_{\beta}(x_i)\right)
\]</span></p>
<p>In vector form:</p>
<p><span class="math display">\[
\nabla\ell(Y,\beta)=\sum_{i=1}^{n} x_{i} \left(y_i- p_{\beta}(x_i)\right)=X^T(Y-P_{\beta})
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\begin{align}
X = \begin{pmatrix}
x_{11} &amp; \cdots &amp; x_{1p} \\
x_{21} &amp; \cdots &amp; x_{2p} \\
\vdots  &amp; \vdots  &amp; \vdots   \\
x_{n1} &amp; \cdots &amp; x_{np}
\end{pmatrix} =
\begin{pmatrix}
x_1^T\\
x_2^T\\
\vdots \\
x_n^T
\end{pmatrix}\in \mathbb{R}^{n\times (p)}, \quad
Y = \begin{pmatrix}
y_{1} \\
y_{2}\\
\vdots \\
y_{n}  
\end{pmatrix} \quad and \quad
P_{\beta} = \begin{pmatrix}
p_{\beta}(x_1) \\
p_{\beta}(x_2)\\
\vdots \\
p_{\beta}(x_n)  
\end{pmatrix}
\end{align}
\]</span></p>
<p>In the literature <span class="math inline">\(\nabla\ell(Y,\beta)\)</span> is denoted as the Fisher’s score function <span class="math inline">\(S(\beta)\)</span>, if the MLE <span class="math inline">\(\hat\beta\)</span> exists, we have:</p>
<p><span class="math display">\[
S(\hat\beta)=\nabla\ell(Y,\hat\beta)=X^T(Y-P_{\hat\beta})=0
\]</span></p>
<p>Solving this equation involves solving <span class="math inline">\(p\)</span> non-linear equations in <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math display">\[
y_1 x_{1j} + \cdots + y_n x_{nj} = x_{1j}\frac{\exp(x_1^T\beta)}{1+\exp(x_1^T\beta)}+ \cdots + x_{nj}\frac{\exp(x_n^T\beta)}{1+\exp(x_n^T\beta)},\quad j=1,\cdots,p
\]</span></p>
</section>
<section id="numerical-methods" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="numerical-methods"><span class="header-section-number">2.3.2</span> Numerical methods</h3>
<p>In practice we use numerical methods to solve these non-linear equations as no closed-form solution exist.</p>
<p>If we assume that <span class="math inline">\(rank(X)=p\)</span>, we will have that <span class="math inline">\(S(\beta)\)</span> is concave in <span class="math inline">\(\beta\)</span>; hence if we find a local maximum it is a global maximum.</p>
<p>We have for <span class="math inline">\((k,l) \in (1,\cdots,p)^2\)</span>:</p>
<p><span class="math display">\[
\begin{align}
\frac{\partial\mathcal \ell}{\partial\beta_k\partial\beta_l}(\beta)= &amp; \frac{\partial}{\partial\beta_k}
\sum_{i=1}^nx_{il}(y_i-\frac{\exp(x_i^T\beta)}{1+\exp(x_i^T\beta)}) \\
=&amp; -\sum_{i=1}^nx_{il}x_{ik}\frac{\exp(x_i^T\beta)}{(1+\exp(x_i^T\beta))^2} \\
=&amp; -\sum_{i=1}^nx_{ik}p_\beta(x_i)(1-p_\beta(x_i))x_{il}
\end{align}
\]</span></p>
<p>We obtain that in matrix form:</p>
<p><span class="math display">\[
H(\beta)=\nabla^2\ell(Y,\beta)=-X^T W_\beta X
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\begin{align}
W_\beta = \begin{pmatrix}
p_\beta(x_1)(1-p_\beta(x_1)) &amp; \cdots &amp; \cdots\\
\vdots  &amp; \ddots &amp; \vdots \\
\cdots  &amp; \cdots &amp; p_\beta(x_n)(1-p_\beta(x_n))
\end{pmatrix}
\end{align}
\]</span></p>
<p>We have <span class="math inline">\(p_\beta(x_i)(1-p_\beta(x_i))\geq0\)</span> hence <span class="math inline">\(W(\beta)\)</span> is semi-definite negative and since <span class="math inline">\(rank(X)=p\)</span>, <span class="math inline">\(H(\beta)\)</span> is concave.</p>
<p>It is shown in <span class="citation" data-cites="albert1984a">(<a href="#ref-albert1984a" role="doc-biblioref">Albert and Aanderson 1984</a>)</span> that if additionally there is no complete separation in the training set: <img src="images/unique_mle.png" class="img-fluid" data-fig-align="center"></p>
<p>then the MLE exists and is unique.</p>
<section id="the-newton-raphson-a.k.a.-fisher-scoring-method" class="level4" data-number="2.3.2.1">
<h4 data-number="2.3.2.1" class="anchored" data-anchor-id="the-newton-raphson-a.k.a.-fisher-scoring-method"><span class="header-section-number">2.3.2.1</span> The Newton-Raphson (a.k.a. Fisher Scoring) method</h4>
<p>In practice the Newton-Raphson method is used to solve the equation:</p>
<p><span class="math display">\[
S(\beta)=\nabla\ell(Y,\beta)=X^T(Y-P_{\beta})=0
\]</span></p>
<p>Using Taylor expansion of Score <span class="math inline">\(S(\beta)\)</span>:</p>
<p><span class="math display">\[
S(\hat\beta) \approx S(\beta^{(k)})+H(\beta^{(k)})(\hat\beta-\beta^{(k)})
\]</span> and starting from an initial guess of <span class="math inline">\(\beta=\beta_0\)</span>, the Newton-Raphson update formula is:</p>
<p><span class="math display">\[
\beta^{(k+1)} = \beta^{(k)} - H^{-1}(\beta^{(k)})S(\beta^{(k)})
\]</span></p>
<p>We show below a naive implementation of Newton-Raphson method to estimate <span class="math inline">\(\beta\)</span> (also known as Fisher Scoring algorithm in the context of Logistic Regression)</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We put the data frame in matrix form</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># also adding an intercept</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(default_data)),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">as.matrix</span>(default_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(balance, income))) </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"balance"</span>, <span class="st">"income"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We extract the output as vector</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> default_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">default =</span> <span class="fu">if_else</span>(default<span class="sc">==</span><span class="st">'Yes'</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(default)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># We set an initial guess for beta and criterion for stopping</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>nb_iter <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>tol <span class="ot">&lt;-</span> <span class="fl">1e-5</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>lr_solve <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y, beta, nb_iter, tol){</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb_iter){</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># first compute p_beta(X)</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        p_beta <span class="ot">&lt;-</span> <span class="fu">exp</span>(X <span class="sc">%*%</span> beta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(X <span class="sc">%*%</span> beta))</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># then the Score</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        Score_beta <span class="ot">&lt;-</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> (Y<span class="sc">-</span>p_beta)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># and the Hessian</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        W_beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, n)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>(W_beta) <span class="ot">&lt;-</span> p_beta<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_beta)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        Hessian_beta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">t</span>(X) <span class="sc">%*%</span> W_beta <span class="sc">%*%</span> X</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we update beta</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>        new_beta <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">solve</span>(Hessian_beta) <span class="sc">%*%</span> Score_beta</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we check for convergence</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">t</span>(beta<span class="sc">-</span>new_beta) <span class="sc">%*%</span> (beta<span class="sc">-</span>new_beta) <span class="sc">&lt;</span> tol){</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta =</span> beta, <span class="at">hessian =</span> Hessian_beta, <span class="at">nb_iter =</span> i)) </span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>        beta <span class="ot">&lt;-</span> new_beta</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta =</span> beta, <span class="at">hessian =</span> Hessian_beta, <span class="at">nb_iter =</span> i)) </span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>sol <span class="ot">&lt;-</span> <span class="fu">lr_solve</span>(X, Y, beta, nb_iter, tol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We verify that R <code>glm()</code> and our Newton-Raphson algorithm give comparable coefficients:</p>
<ul>
<li>Newton-Raphson:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(<span class="fu">t</span>(sol<span class="sc">$</span>beta))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["balance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-11.53792","2":"0.005645755","3":"2.080353e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li>R <code>glm()</code>:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>glm_bal_inc <span class="ot">&lt;-</span> <span class="fu">glm</span>(default <span class="sc">~</span> balance <span class="sc">+</span> income,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> default_data,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(<span class="fu">t</span>(<span class="fu">coef</span>(glm_bal_inc )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["balance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-11.54047","2":"0.005647103","3":"2.080898e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In the next lesson we will try to understand the outputs of the <code>glm()</code> function from a statistical viewpoint.</p>
</section>
<section id="the-iterative-reweighted-least-square-irls-method" class="level4" data-number="2.3.2.2">
<h4 data-number="2.3.2.2" class="anchored" data-anchor-id="the-iterative-reweighted-least-square-irls-method"><span class="header-section-number">2.3.2.2</span> The Iterative Reweighted Least Square (IRLS) method</h4>
<p>There is an equivalent approach to the the Newton-Raphson described in the literature as Iterative Reweighted Least Square (IRLS).</p>
<p>The Newton-Raphson update formula rewrites:</p>
<p><span class="math display">\[
\begin{align}
\beta^{(k+1)} &amp;= \beta^{(k)} - H^{-1}(\beta^{(k)})S(\beta^{(k)}) \\
&amp;=\beta^{(k)} + (X^TW_{\beta^{(k)}}X)^{-1}X^T(Y-P_{\beta^{(k)}}) \\
&amp;= (X^TW_{\beta^{(k)}}X)^{-1}(X^TW_{\beta^{(k)}}X)\beta^{(k)} + (X^TW_{\beta^{(k)}}X)^{-1}X^T(Y-P_{\beta^{(k)}}) \\
&amp;= (X^TW_{\beta^{(k)}}X)^{-1}X^TW_{\beta^{(k)}}\left(X\beta^{(k)}+W_{\beta^{(k)}}^{-1}(Y-P_{\beta^{(k)}}) \right) \\
&amp;= (X^TW_{\beta^{(k)}}X)^{-1}X^TW_{\beta^{(k)}}Z_{\beta^{(k)}} \\
\end{align}
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
Z_{\beta^{(k)}}= X\beta^{(k)}+W_{\beta^{(k)}}^{-1}(Y-P_{\beta^{(k)}})
\]</span></p>
<p><span class="math inline">\(\beta^{(k+1)} = (X^TW_{\beta^{(k)}}X)^{-1}X^TW_{\beta^{(k)}}Z_{\beta{(k)}}\)</span> corresponds to the solution of a weighted (<span class="math inline">\(W_{\beta^{(k)}}\)</span>) linear regression of <span class="math inline">\(Z_{\beta^{(k)}}\)</span> by <span class="math inline">\(X\)</span>. As an exercise you can implement this algorithm.</p>
<p>Is is a good exercise to sharpen your <code>R</code> skills to implement this algorithm and compare its results with the Newton method.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We put the data frame in matrix form</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># also adding an intercept</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(default_data)),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">as.matrix</span>(default_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(balance, income))) </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"balance"</span>, <span class="st">"income"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We extract the output as vector</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> default_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">default =</span> <span class="fu">if_else</span>(default<span class="sc">==</span><span class="st">'Yes'</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(default)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>default_data_IRLS <span class="ot">&lt;-</span> default_data <span class="sc">%&gt;%</span> </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(default<span class="sc">==</span><span class="st">'Yes'</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Y, balance, income)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># We set an initial guess for beta and criterion for stopping</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>nb_iter <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>tol <span class="ot">&lt;-</span> <span class="fl">1e-5</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>lr_solve_IRLS <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y, beta, nb_iter, tol){</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb_iter){</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># first compute p_beta(X)</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        p_beta <span class="ot">&lt;-</span> <span class="fu">exp</span>(X <span class="sc">%*%</span> beta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(X <span class="sc">%*%</span> beta))</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># then the Score</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        Score_beta <span class="ot">&lt;-</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> (Y<span class="sc">-</span>p_beta)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># and the Hessian (storing its diag for further usage)</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>        W_beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, n)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>        w <span class="ot">&lt;-</span> p_beta<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_beta)</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>(W_beta) <span class="ot">&lt;-</span> w</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>        Hessian_beta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">t</span>(X) <span class="sc">%*%</span> W_beta <span class="sc">%*%</span> X</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># rewriting Newton step as a weighted (with diagonal elements of W_beta)</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># least square problem on modified target Z</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>        Z <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta <span class="sc">+</span> (Y<span class="sc">-</span>p_beta) <span class="sc">/</span> w</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>        wls <span class="ot">&lt;-</span> <span class="fu">lm</span>(Z <span class="sc">~</span> ., <span class="at">data=</span><span class="fu">tibble</span>(<span class="at">Z =</span> Z[,<span class="dv">1</span>], default_data_IRLS <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Y)) , <span class="at">weights=</span>w)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we update beta with weighted least square coefficients</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>        new_beta <span class="ot">&lt;-</span> wls<span class="sc">$</span>coefficients</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we check for convergence</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">t</span>(beta<span class="sc">-</span>new_beta) <span class="sc">%*%</span> (beta<span class="sc">-</span>new_beta) <span class="sc">&lt;</span> tol){</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta =</span> beta, <span class="at">hessian =</span> Hessian_beta, <span class="at">nb_iter =</span> i)) </span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>        beta <span class="ot">&lt;-</span> new_beta</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta =</span> beta, <span class="at">hessian =</span> Hessian_beta, <span class="at">nb_iter =</span> i)) </span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>sol_IRLS <span class="ot">&lt;-</span> <span class="fu">lr_solve_IRLS</span>(X, Y, beta, nb_iter, tol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We verify that R <code>glm()</code> and our IRLS algorithm give similar coefficients:</p>
<ul>
<li>IRLS:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(<span class="fu">t</span>(sol<span class="sc">$</span>beta))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["balance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-11.53792","2":"0.005645755","3":"2.080353e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li>R <code>glm()</code>:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(<span class="fu">t</span>(<span class="fu">coef</span>(glm_bal_inc )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["balance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-11.54047","2":"0.005647103","3":"2.080898e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="example-where-mle-is-not-finite" class="level4" data-number="2.3.2.3">
<h4 data-number="2.3.2.3" class="anchored" data-anchor-id="example-where-mle-is-not-finite"><span class="header-section-number">2.3.2.3</span> Example where MLE is not finite</h4>
<p>To conclude on the numerical aspects, we signal a special and extreme case where the iterative algorithm won’t converge. The theoretical aspect is covered in <span class="citation" data-cites="albert1984a">(<a href="#ref-albert1984a" role="doc-biblioref">Albert and Aanderson 1984</a>)</span>.</p>
<p>We simulate a perfectly separated data set. Here <span class="math inline">\(X\in \mathbb [-1,1]\)</span> and <span class="math inline">\(Y\in\{0,1\}\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1987</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">0</span>),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">50</span>))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>tbl_separated <span class="ot">&lt;-</span> <span class="fu">tibble</span>(X,Y)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tbl_separated) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(X, Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this setting the iterative algorithm fails to converge and coefficient “saturates” to a high/low value (while it should go to infinite):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>glm_separated <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> tbl_separated,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>glm_separated<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           X 
  -5.763399 4227.385776 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>separated_fit <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(glm_separated, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(separated_fit) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(X, Y)) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(X,.fitted))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now we slightly modify the data set, changing a <span class="math inline">\(y\)</span> observation with <span class="math inline">\(x\in[-1,0]\)</span> from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> Y</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Y1[<span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>tbl_overlap <span class="ot">&lt;-</span> <span class="fu">tibble</span>(X,Y1)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tbl_overlap) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(X, Y1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The iterative algorithm converges again and the impact on the Scoring function (i.e.&nbsp;<span class="math inline">\(\mathbb{P}[Y=1|X=x)\)</span>) and the decision rule (shifting left below <span class="math inline">\(X=O\)</span>) is not negligible for a one point change:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>glm_overlap <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y1 <span class="sc">~</span> X,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> tbl_separated,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>overlap_fit <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(glm_overlap, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(overlap_fit) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(X, Y1)) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(X,.fitted))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nonetheless the case we described is very unlikely to happen in a real life setting, and a good data set exploration should avoid such trap. More details can be found in the document <code>Separation and Convergence Issues in Logistic Regression.pdf</code></p>
</section>
</section>
<section id="logistic-regression-as-a-machine-learning-approach" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="logistic-regression-as-a-machine-learning-approach"><span class="header-section-number">2.3.3</span> Logistic Regression as a machine learning approach</h3>
<p>We have another look at the log-likelihood equation stated before, we have:</p>
<p><span class="math display">\[
\begin{align}
\ell(Y,\beta)=\log L(Y,\beta) &amp;=\sum_{i=1}^n \left(y_i \log(p_{\beta}(x_i))+(1-y_i) \log(1- p_{\beta}(x_i))\right) \\
                              &amp;=-\sum_{i=1}^{n} \ell_{logistic} \left(p_{\beta}(x_i),y_i\right) \\
                              &amp;= -n\hat{\mathrm R}(p_\beta)
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\ell_{logistic}: \{0,1\}\times \{0,1\} \to \mathbb R^+\)</span>:</p>
<p><span class="math display">\[
\ell_{logistic}(y,z) = -y\log(z)-(1-y)\log(1-z)=\left\{ \begin{array}{ll}
    -\log(z) &amp;  \mbox{if } y = 1\cr
    -\log(1-z) &amp;  \mbox{if } y = 0\cr
\end{array} \right.
\]</span></p>
<p>and <span class="math inline">\(\hat{\mathrm {R}}(p_\beta)\)</span> is the empirical risk on the training set.</p>
<p>Estimating <span class="math inline">\(\beta\)</span> by maximizing the log-likelihood is equivalent to minimizing with respect to <span class="math inline">\(\beta\)</span> the empirical risk of <span class="math inline">\(p_\beta\)</span> for the logistic loss. Note that usually in the context of machine learning and logistic loss, the output <span class="math inline">\(Y\)</span> is relabeled to <span class="math inline">\(\{-1,1\}\)</span>.</p>
</section>
</section>
<section id="real-life-data-sets" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="real-life-data-sets"><span class="header-section-number">2.4</span> Real life data sets</h2>
<p>We introduce below two interesting data sets that can be used to apply the methods seen in the course.</p>
<section id="the-german-credit-data-set" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="the-german-credit-data-set"><span class="header-section-number">2.4.1</span> The <strong>German Credit</strong> data set</h3>
<p>This data set mainly composed of categorical features is analysed in depth in <span class="citation" data-cites="tufféry2011">Tufféry (<a href="#ref-tufféry2011" role="doc-biblioref">2011</a>)</span> and the analysis has been extended in the Chapter 4 of <span class="citation" data-cites="computat2014">Charpentier (<a href="#ref-computat2014" role="doc-biblioref">2014</a>)</span> using the R programming language and a statistical learning approach (it is a very good reference covering Logistic Regression, Stepwise variable selection, Penalized Logistic Regression, Decision Trees and Ensemble methods with a mix of theory and practice). Part of the analysis is available in this <a href="https://www.r-bloggers.com/2016/03/classification-on-the-german-credit-database/">blog post</a> by A. Charpentier, who also open sourced many excellent courses among which <a href="https://github.com/freakonometrics/STT5100/">Applied Linear Models</a> and <a href="https://github.com/freakonometrics/ACT6100/">Data Science for Actuaries</a>.</p>
<p>The German Credit data set is available at the <a href="https://archive.ics.uci.edu/ml/datasets/statlog+(german+credit+data)">UCI archive</a>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'../data/germancredit.RData'</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>germancredit_clean <span class="ot">&lt;-</span> germancredit <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_all</span>(<span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(., <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">creditability =</span> <span class="fu">as.factor</span>(<span class="fu">as.numeric</span>(creditability) <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span>  <span class="co"># map target to 0 (good credit) 1 (bad credit)</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>           <span class="co"># age_binned = cut(age_in_years, c(0, 25, Inf)),</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>           <span class="co"># credit_amount_binned = cut(credit_amount, c(0, 2500, Inf)),</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>           <span class="co"># duration_binned = cut(duration_in_month, c(0, 15, 36, Inf))) %&gt;% </span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">status =</span> status_of_existing_checking_account,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">duration =</span> duration_in_month,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">history =</span> credit_history,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">amount =</span> credit_amount,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">savings =</span> savings_account_and_bonds,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">job_since =</span> present_employment_since,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">icr =</span> installment_rate_in_percentage_of_disposable_income,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">personal =</span> personal_status_and_sex,</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">resid_since =</span> present_residence_since,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">age =</span> age_in_years,</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">debtors_guarantors =</span> other_debtors_or_guarantors,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">existing_credits =</span> number_of_existing_credits_at_this_bank,</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">to_provide =</span> number_of_people_being_liable_to_provide_maintenance_for</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(germancredit_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 21
$ status                  &lt;fct&gt; ... &lt; 0 DM, 0 &lt;= ... &lt; 200 DM, no checking acc…
$ duration                &lt;dbl&gt; 6, 48, 12, 42, 24, 36, 24, 36, 12, 30, 12, 48,…
$ history                 &lt;fct&gt; critical account/ other credits existing (not …
$ purpose                 &lt;chr&gt; "radio/television", "radio/television", "educa…
$ amount                  &lt;dbl&gt; 1169, 5951, 2096, 7882, 4870, 9055, 2835, 6948…
$ savings                 &lt;fct&gt; unknown/ no savings account, ... &lt; 100 DM, ...…
$ job_since               &lt;fct&gt; ... &gt;= 7 years, 1 &lt;= ... &lt; 4 years, 4 &lt;= ... &lt;…
$ icr                     &lt;dbl&gt; 4, 2, 2, 2, 3, 2, 3, 2, 2, 4, 3, 3, 1, 4, 2, 4…
$ personal                &lt;fct&gt; male : divorced/separated, male : divorced/sep…
$ debtors_guarantors      &lt;fct&gt; none, none, none, guarantor, none, none, none,…
$ resid_since             &lt;dbl&gt; 4, 2, 3, 4, 4, 4, 4, 2, 4, 2, 1, 4, 1, 4, 4, 2…
$ property                &lt;fct&gt; "real estate", "real estate", "real estate", "…
$ age                     &lt;dbl&gt; 67, 22, 49, 45, 53, 35, 53, 35, 61, 28, 25, 24…
$ other_installment_plans &lt;fct&gt; none, none, none, none, none, none, none, none…
$ housing                 &lt;fct&gt; own, own, own, for free, for free, for free, o…
$ existing_credits        &lt;dbl&gt; 2, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1…
$ job                     &lt;fct&gt; skilled employee / official, skilled employee …
$ to_provide              &lt;dbl&gt; 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ telephone               &lt;fct&gt; "yes, registered under the customers name", "n…
$ foreign_worker          &lt;fct&gt; yes, yes, yes, yes, yes, yes, yes, yes, yes, y…
$ creditability           &lt;fct&gt; 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0…</code></pre>
</div>
</div>
<p>Description of the data:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>vars_quanti <span class="ot">&lt;-</span> <span class="fu">names</span>(germancredit_clean <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> vars_quanti){</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">as.name</span>(var)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">ggplot</span>(germancredit_clean <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">creditability =</span> <span class="fu">as.numeric</span>(creditability)<span class="sc">-</span><span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span> var,<span class="at">y =</span> creditability)) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>), </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col =</span> <span class="st">"dodgerblue"</span>))</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-50-7.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>germancredit_clean <span class="ot">&lt;-</span> germancredit_clean <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">icr =</span> <span class="fu">as.factor</span>(icr),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">resid_since =</span> <span class="fu">as.factor</span>(resid_since),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">existing_credits =</span> <span class="fu">as.factor</span>(existing_credits),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">to_provide =</span> <span class="fu">as.factor</span>(to_provide)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>vars_quali <span class="ot">&lt;-</span> <span class="fu">names</span>(germancredit_clean <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.factor) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>creditability))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> vars_quali){</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">as.name</span>(var)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">ggplot</span>(germancredit_clean <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">group_by</span>(<span class="sc">!!</span>var, creditability) <span class="sc">%&gt;%</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ungroup</span>()) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> creditability, <span class="at">y =</span> count, <span class="at">fill =</span> <span class="sc">!!</span>var), <span class="at">position=</span><span class="st">"dodge"</span>,<span class="at">stat=</span><span class="st">"identity"</span>))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-10.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-11.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-12.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-13.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-14.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-15.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-52-16.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>germancredit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(creditability <span class="sc">~</span> . , <span class="at">data =</span> germancredit_clean, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(germancredit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = creditability ~ ., family = "binomial", data = germancredit_clean)

Coefficients:
                                                                     Estimate
(Intercept)                                                         6.661e-01
status0 &lt;= ... &lt; 200 DM                                             3.785e-01
status... &gt;= 200 DM / salary assignments for at least 1 year        9.627e-01
statusno checking account                                           1.793e+00
duration                                                           -2.906e-02
historyall credits at this bank paid back duly                     -1.802e-01
historyexisting credits paid back duly till now                     5.129e-01
historydelay in paying off in the past                              9.627e-01
historycritical account/ other credits existing (not at this bank)  1.448e+00
purposecar (new)                                                   -6.407e-01
purposecar (used)                                                   9.629e-01
purposedomestic appliances                                         -1.912e-01
purposeeducation                                                   -7.805e-01
purposefurniture/equipment                                          7.425e-02
purposeothers                                                       8.465e-01
purposeradio/television                                             2.004e-01
purposerepairs                                                     -5.053e-01
purposeretraining                                                   1.176e+00
amount                                                             -1.091e-04
savings100 &lt;= ... &lt; 500 DM                                          3.498e-01
savings500 &lt;= ... &lt; 1000 DM                                         3.753e-01
savings... &gt;= 1000 DM                                               1.385e+00
savingsunknown/ no savings account                                  9.987e-01
job_since... &lt; 1 year                                              -1.659e-01
job_since1 &lt;= ... &lt; 4 years                                         1.900e-01
job_since4 &lt;= ... &lt; 7 years                                         8.492e-01
job_since... &gt;= 7 years                                             2.575e-01
icr2                                                               -1.586e-01
icr3                                                               -4.868e-01
icr4                                                               -7.572e-01
personalfemale : divorced/separated/married                        -5.580e-01
personalmale : single                                              -6.019e-01
personalmale : married/widowed                                     -5.000e-01
debtors_guarantorsco-applicant                                     -3.650e-01
debtors_guarantorsguarantor                                         1.004e+00
resid_since2                                                       -7.091e-01
resid_since3                                                       -4.795e-01
resid_since4                                                       -3.594e-01
propertybuilding society savings agreement/ life insurance         -2.536e-01
propertycar or other, not in attribute Savings account/bonds       -1.740e-01
propertyunknown / no property                                      -6.688e-01
age                                                                 1.208e-02
other_installment_plansstores                                       1.242e-01
other_installment_plansnone                                         6.206e-01
housingown                                                          5.599e-01
housingfor free                                                     7.290e-01
existing_credits2                                                  -4.008e-01
existing_credits3                                                  -2.278e-01
existing_credits4                                                  -3.913e-01
jobunskilled - resident                                            -4.207e-01
jobskilled employee / official                                     -4.561e-01
jobmanagement/ self-employed/ highly qualified employee/ officer   -3.912e-01
to_provide2                                                        -5.758e-02
telephoneyes, registered under the customers name                   2.891e-01
foreign_workerno                                                    1.475e+00
                                                                   Std. Error
(Intercept)                                                         1.025e+00
status0 &lt;= ... &lt; 200 DM                                             2.179e-01
status... &gt;= 200 DM / salary assignments for at least 1 year        3.694e-01
statusno checking account                                           2.348e-01
duration                                                            9.382e-03
historyall credits at this bank paid back duly                      5.620e-01
historyexisting credits paid back duly till now                     4.415e-01
historydelay in paying off in the past                              4.749e-01
historycritical account/ other credits existing (not at this bank)  4.424e-01
purposecar (new)                                                    3.324e-01
purposecar (used)                                                   4.373e-01
purposedomestic appliances                                          8.114e-01
purposeeducation                                                    4.644e-01
purposefurniture/equipment                                          3.519e-01
purposeothers                                                       7.900e-01
purposeradio/television                                             3.345e-01
purposerepairs                                                      6.047e-01
purposeretraining                                                   1.176e+00
amount                                                              4.428e-05
savings100 &lt;= ... &lt; 500 DM                                          2.906e-01
savings500 &lt;= ... &lt; 1000 DM                                         4.060e-01
savings... &gt;= 1000 DM                                               5.413e-01
savingsunknown/ no savings account                                  2.642e-01
job_since... &lt; 1 year                                               4.378e-01
job_since1 &lt;= ... &lt; 4 years                                         4.196e-01
job_since4 &lt;= ... &lt; 7 years                                         4.597e-01
job_since... &gt;= 7 years                                             4.213e-01
icr2                                                                3.067e-01
icr3                                                                3.381e-01
icr4                                                                2.986e-01
personalfemale : divorced/separated/married                         4.241e-01
personalmale : single                                               4.114e-01
personalmale : married/widowed                                      4.811e-01
debtors_guarantorsco-applicant                                      4.153e-01
debtors_guarantorsguarantor                                         4.207e-01
resid_since2                                                        2.970e-01
resid_since3                                                        3.357e-01
resid_since4                                                        3.009e-01
propertybuilding society savings agreement/ life insurance          2.556e-01
propertycar or other, not in attribute Savings account/bonds        2.384e-01
propertyunknown / no property                                       4.256e-01
age                                                                 9.205e-03
other_installment_plansstores                                       4.140e-01
other_installment_plansnone                                         2.398e-01
housingown                                                          2.335e-01
housingfor free                                                     4.828e-01
existing_credits2                                                   2.425e-01
existing_credits3                                                   5.997e-01
existing_credits4                                                   1.084e+00
jobunskilled - resident                                             6.821e-01
jobskilled employee / official                                      6.570e-01
jobmanagement/ self-employed/ highly qualified employee/ officer    6.656e-01
to_provide2                                                         2.433e-01
telephoneyes, registered under the customers name                   2.022e-01
foreign_workerno                                                    6.151e-01
                                                                   z value
(Intercept)                                                          0.650
status0 &lt;= ... &lt; 200 DM                                              1.737
status... &gt;= 200 DM / salary assignments for at least 1 year         2.606
statusno checking account                                            7.636
duration                                                            -3.097
historyall credits at this bank paid back duly                      -0.321
historyexisting credits paid back duly till now                      1.162
historydelay in paying off in the past                               2.027
historycritical account/ other credits existing (not at this bank)   3.274
purposecar (new)                                                    -1.927
purposecar (used)                                                    2.202
purposedomestic appliances                                          -0.236
purposeeducation                                                    -1.681
purposefurniture/equipment                                           0.211
purposeothers                                                        1.071
purposeradio/television                                              0.599
purposerepairs                                                      -0.836
purposeretraining                                                    1.000
amount                                                              -2.464
savings100 &lt;= ... &lt; 500 DM                                           1.204
savings500 &lt;= ... &lt; 1000 DM                                          0.924
savings... &gt;= 1000 DM                                                2.559
savingsunknown/ no savings account                                   3.780
job_since... &lt; 1 year                                               -0.379
job_since1 &lt;= ... &lt; 4 years                                          0.453
job_since4 &lt;= ... &lt; 7 years                                          1.847
job_since... &gt;= 7 years                                              0.611
icr2                                                                -0.517
icr3                                                                -1.440
icr4                                                                -2.536
personalfemale : divorced/separated/married                         -1.316
personalmale : single                                               -1.463
personalmale : married/widowed                                      -1.039
debtors_guarantorsco-applicant                                      -0.879
debtors_guarantorsguarantor                                          2.387
resid_since2                                                        -2.388
resid_since3                                                        -1.428
resid_since4                                                        -1.194
propertybuilding society savings agreement/ life insurance          -0.992
propertycar or other, not in attribute Savings account/bonds        -0.730
propertyunknown / no property                                       -1.571
age                                                                  1.313
other_installment_plansstores                                        0.300
other_installment_plansnone                                          2.588
housingown                                                           2.398
housingfor free                                                      1.510
existing_credits2                                                   -1.653
existing_credits3                                                   -0.380
existing_credits4                                                   -0.361
jobunskilled - resident                                             -0.617
jobskilled employee / official                                      -0.694
jobmanagement/ self-employed/ highly qualified employee/ officer    -0.588
to_provide2                                                         -0.237
telephoneyes, registered under the customers name                    1.430
foreign_workerno                                                     2.398
                                                                   Pr(&gt;|z|)    
(Intercept)                                                        0.515916    
status0 &lt;= ... &lt; 200 DM                                            0.082325 .  
status... &gt;= 200 DM / salary assignments for at least 1 year       0.009167 ** 
statusno checking account                                          2.24e-14 ***
duration                                                           0.001952 ** 
historyall credits at this bank paid back duly                     0.748521    
historyexisting credits paid back duly till now                    0.245407    
historydelay in paying off in the past                             0.042650 *  
historycritical account/ other credits existing (not at this bank) 0.001062 ** 
purposecar (new)                                                   0.053948 .  
purposecar (used)                                                  0.027655 *  
purposedomestic appliances                                         0.813698    
purposeeducation                                                   0.092859 .  
purposefurniture/equipment                                         0.832871    
purposeothers                                                      0.283960    
purposeradio/television                                            0.549049    
purposerepairs                                                     0.403364    
purposeretraining                                                  0.317464    
amount                                                             0.013752 *  
savings100 &lt;= ... &lt; 500 DM                                         0.228657    
savings500 &lt;= ... &lt; 1000 DM                                        0.355318    
savings... &gt;= 1000 DM                                              0.010512 *  
savingsunknown/ no savings account                                 0.000157 ***
job_since... &lt; 1 year                                              0.704790    
job_since1 &lt;= ... &lt; 4 years                                        0.650723    
job_since4 &lt;= ... &lt; 7 years                                        0.064702 .  
job_since... &gt;= 7 years                                            0.540962    
icr2                                                               0.605122    
icr3                                                               0.149986    
icr4                                                               0.011207 *  
personalfemale : divorced/separated/married                        0.188292    
personalmale : single                                              0.143496    
personalmale : married/widowed                                     0.298641    
debtors_guarantorsco-applicant                                     0.379464    
debtors_guarantorsguarantor                                        0.017000 *  
resid_since2                                                       0.016958 *  
resid_since3                                                       0.153175    
resid_since4                                                       0.232346    
propertybuilding society savings agreement/ life insurance         0.321018    
propertycar or other, not in attribute Savings account/bonds       0.465475    
propertyunknown / no property                                      0.116082    
age                                                                0.189287    
other_installment_plansstores                                      0.764252    
other_installment_plansnone                                        0.009650 ** 
housingown                                                         0.016495 *  
housingfor free                                                    0.131085    
existing_credits2                                                  0.098354 .  
existing_credits3                                                  0.704002    
existing_credits4                                                  0.718110    
jobunskilled - resident                                            0.537358    
jobskilled employee / official                                     0.487554    
jobmanagement/ self-employed/ highly qualified employee/ officer   0.556750    
to_provide2                                                        0.812928    
telephoneyes, registered under the customers name                  0.152737    
foreign_workerno                                                   0.016484 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1221.73  on 999  degrees of freedom
Residual deviance:  895.37  on 945  degrees of freedom
AIC: 1005.4

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</section>
<section id="agriculture-farm-lending" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="agriculture-farm-lending"><span class="header-section-number">2.4.2</span> Agriculture Farm Lending</h3>
<p>The article <span class="citation" data-cites="desbois2008">Desbois (<a href="#ref-desbois2008" role="doc-biblioref">2008</a>)</span> (available <a href="https://csbigs.fr/index.php/csbigs/article/view/351">here</a> together with a sample data set) shows a complete case study around the detection of financial risks applicable to farm holdings. Linear Discriminant Analysis and Logistic Regression (plus stepwise variable selection) are used and ROC curves are used to compare the two methods.</p>
<p>The data set uses a format specific to the SPSS software, but is readable from R using the <code>foreign</code> package. The case study by Desbois will be partly reproduced in the next lesson.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># package used to import spss file</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>don_desbois <span class="ot">&lt;-</span> <span class="fu">read.spss</span>(<span class="st">"../data/Agriculture Farm Lending/desbois.sav"</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>don_desbois <span class="ot">&lt;-</span> don_desbois <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fu">if_else</span>(DIFF<span class="sc">==</span><span class="st">'healthy'</span>, <span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>DIFF)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> STATUS <span class="sc">+</span> HECTARE <span class="sc">+</span> r1 <span class="sc">+</span> r3 <span class="sc">+</span> r17 <span class="sc">+</span> r24 <span class="sc">+</span> r28 <span class="sc">+</span> r36,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> don_desbois,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">maxit =</span> <span class="dv">100</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ STATUS + HECTARE + r1 + r3 + r17 + r24 + r28 + 
    r36, family = "binomial", data = don_desbois, maxit = 100)

Coefficients:
                               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -7.016210   0.865925  -8.103 5.38e-16 ***
STATUSEntreprise individuelle -1.284335   0.322912  -3.977 6.97e-05 ***
HECTARE                       -0.027157   0.003316  -8.189 2.62e-16 ***
r1                            10.036873   0.638453  15.721  &lt; 2e-16 ***
r3                             5.019766   0.622102   8.069 7.09e-16 ***
r17                           44.767724   5.073126   8.824  &lt; 2e-16 ***
r24                           -3.580851   2.445605  -1.464   0.1431    
r28                           -4.138737   1.823326  -2.270   0.0232 *  
r36                            1.595586   0.312600   5.104 3.32e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1745.05  on 1259  degrees of freedom
Residual deviance:  612.35  on 1251  degrees of freedom
AIC: 630.35

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> OWNLAND <span class="sc">+</span> r17,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> don_desbois,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ OWNLAND + r17, family = "binomial", data = don_desbois)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.8375     0.1743 -10.543  &lt; 2e-16 ***
OWNLANDyes   -0.5975     0.1282  -4.659 3.18e-06 ***
r17          31.0881     2.6556  11.707  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1745.1  on 1259  degrees of freedom
Residual deviance: 1578.8  on 1257  degrees of freedom
AIC: 1584.8

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="exercises" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Exercises</h1>
<section id="roc-curves-partly-inspired-from-exercise-11.10-cornillon2019" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="roc-curves-partly-inspired-from-exercise-11.10-cornillon2019"><span class="header-section-number">3.1</span> ROC curves (partly inspired from Exercise 11.10 <span class="citation" data-cites="cornillon2019">(<a href="#ref-cornillon2019" role="doc-biblioref">Cornillon and Matzner-Løber 2019</a>)</span>)</h2>
<p>Using the Mixture data set, plot ROC curves for some chosen classifiers:</p>
<ul>
<li>first by implementing from scratch a method for plotting ROC curves using the course definition:</li>
</ul>
<p>For a given threshold <span class="math inline">\(s\)</span> and passing as argument a column of outputs <span class="math inline">\(Y\)</span> together with a score column (i.e.&nbsp;predicted probabilities) we define a function to obtain the False/True Positive Rates:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>roc_curve <span class="ot">&lt;-</span> <span class="cf">function</span>(s, error_rate){</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># error_rate is a tibble containing a column Y of true values and a column of score/probabilities </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># let s be a threshold in R</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    output <span class="ot">&lt;-</span> <span class="fu">factor</span>(error_rate <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify using model probabilities (ie the score) and the threshold s</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    classifier <span class="ot">&lt;-</span> error_rate <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">classifier =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(score<span class="sc">&gt;=</span>s, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(classifier)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build the confusion matrix and ROC curve coordinates for the given s</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (x(s) = false_positive_rate, y(s) = true_positive_rate)</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    conf_mat <span class="ot">&lt;-</span> <span class="fu">table</span>(output, classifier)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#       classifier</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># output    0       1</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      0 3681(TN) 1319(FP)</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      1 1586(FN) 3414(TP)</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    true_negative <span class="ot">&lt;-</span> conf_mat[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    false_positive <span class="ot">&lt;-</span> conf_mat[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    false_negative <span class="ot">&lt;-</span> conf_mat[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    true_positive <span class="ot">&lt;-</span> conf_mat[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    false_positive_rate <span class="ot">&lt;-</span> false_positive <span class="sc">/</span> (false_positive <span class="sc">+</span> true_negative)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    true_positive_rate <span class="ot">&lt;-</span> true_positive <span class="sc">/</span> (false_negative <span class="sc">+</span> true_positive) <span class="co"># aka sensitivity</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">threshold =</span> s, <span class="at">fpr =</span> false_positive_rate, <span class="at">tpr =</span> true_positive_rate))</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We first use this function to plot the ROC curve (passing a vector of thresholds <span class="math inline">\(s\)</span>) for a Logistic Regression classifier defined and fitted in the first section of the course:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In the case of logistic regression, we use the regression function in [0, 1] as a scoring function</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We vary s in [0, 1] to compute the ROC parametric curve </span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>roc_coordinates_logit <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)){</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    roc_coordinates_logit <span class="ot">&lt;-</span> <span class="fu">append</span>(roc_coordinates_logit,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">list</span>(<span class="fu">roc_curve</span>(s, logit_error_rate <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score =</span> .fitted))))</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>roc_coordinates_logit <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(roc_coordinates_logit)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_coordinates_logit, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We then use it to plot the ROC curve for a Logistic Regression classifier using predictors modified using splines:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In the case of logistic regression, we use the regression function in [0, 1] as a scoring function</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We vary s in [0, 1] to compute the ROC parametric curve </span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>roc_coordinates_logit_splines <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)){</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    roc_coordinates_logit_splines <span class="ot">&lt;-</span> <span class="fu">append</span>(roc_coordinates_logit_splines,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">list</span>(<span class="fu">roc_curve</span>(s, logit_splines_add_error_rate <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score =</span> .fitted))))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>roc_coordinates_logit_splines <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(roc_coordinates_logit_splines)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_coordinates_logit_splines, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We then use it to plot the ROC curve for a Logistic Regression classifier using discretized quantitative predictors (binning):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In the case of logistic regression, we use the regression function in [0, 1] as a scoring function</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We vary s in [0, 1] to compute the ROC parametric curve </span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>roc_coordinates_logit_binned <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)){</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    roc_coordinates_logit_binned <span class="ot">&lt;-</span> <span class="fu">append</span>(roc_coordinates_logit_binned,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">list</span>(<span class="fu">roc_curve</span>(s, logit_binned_error_rate <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score =</span> .fitted))))</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>roc_coordinates_logit_binned <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(roc_coordinates_logit_binned)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_coordinates_logit_binned, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To finish we show the ROC curve for a Decision Tree method:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In the case of cart, we use the predicted prob in [0, 1] as a scoring function</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Caution, with decision trees, the "probability" or score function is given by the belonging to a terminal node</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In our case we have 6 terminal nodes, yielding only 6 possible probabilities for an observation:</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cart_error_rate %&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(prob) %&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(n = n())</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 × 2</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     prob     n</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 0        583</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 0.0769  2871</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 0.241   1521</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 0.714    515</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 0.821   3597</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 0.952    913</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co"># So only the thresholds s [0 0.0769 0.241 0.714 0.821 0.952] will modify the confusion matrix</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co"># For logistic regression for example and sufficient number of observations, the range of predicted probabilities</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co"># although discrete </span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="co"># See also https://stats.stackexchange.com/questions/105760/how-we-can-draw-an-roc-curve-for-decision-trees</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/40385478/why-dont-we-get-a-smooth-roc-curve-in-cart-models</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="co"># We vary s in [0, 1] to compute a pseudo ROC parametric curve for CART (in fact only "points" for each of the preceding thresholds)</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>roc_coordinates_cart<span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)){</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    roc_coordinates_cart <span class="ot">&lt;-</span> <span class="fu">append</span>(roc_coordinates_cart,</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">list</span>(<span class="fu">roc_curve</span>(s, cart_error_rate <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score =</span> prob))))</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>roc_coordinates_cart <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(roc_coordinates_cart)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_coordinates_cart, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Plotting the ROC curves together:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> roc_coordinates_logit, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr, <span class="at">color =</span> <span class="st">'logistic'</span>)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> roc_coordinates_logit_splines, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr, <span class="at">color =</span> <span class="st">'logistic splines'</span>)) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> roc_coordinates_logit_binned, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr, <span class="at">color =</span> <span class="st">'logistic binned'</span>)) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> roc_coordinates_cart, <span class="fu">aes</span>(<span class="at">x=</span>fpr, <span class="at">y =</span> tpr, <span class="at">col =</span> <span class="st">'decision tree'</span>)) <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name=</span><span class="st">'Model'</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">'logistic'</span>, <span class="st">'logistic splines'</span>, <span class="st">'logistic binned'</span>, <span class="st">'decision tree'</span>),</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values=</span><span class="fu">c</span>(<span class="st">'logistic'</span><span class="ot">=</span><span class="st">'darkorange'</span>, </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'logistic splines'</span> <span class="ot">=</span> <span class="st">'darkolivegreen'</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'logistic binned'</span> <span class="ot">=</span> <span class="st">'plum4'</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'decision tree'</span><span class="ot">=</span><span class="st">'dodgerblue'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>then using the <code>ROCR</code> package (see <code>ROCR_Talk_Tobias_Sing.ppt</code> in course repository for a presentation by its authors)</li>
</ul>
<p>The library <code>ROCR</code> needs to first build a <code>prediction</code> object using a column of outputs <span class="math inline">\(Y\)</span> together with a score column (i.e.&nbsp;predicted probabilities), then to build a <code>performance</code> object (for a ROC curve the arguments <code>measure = "tpr", x.measure = "fpr"</code> should be passed to <code>performance()</code> together with the <code>prediction</code> object / for the AUC the argument <code>measure = "auc"</code> should be passed to <code>performance()</code> together with the <code>prediction</code> object)</p>
<p>We obtain the same curves as before:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC Curves with ROCR</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ROCR"</span>)    </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># logit_error_rate$.fitted: predicted probabilities</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># logit_error_rate$Y: column of outputs Y</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># logit</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(logit_error_rate<span class="sc">$</span>.fitted, logit_error_rate<span class="sc">$</span>Y)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkorange"</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="co">#add a 45 degree line</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># compute empirical AUC with ROCR for base logit model</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>auc_logit <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>auc_logit <span class="ot">&lt;-</span> auc_logit<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co"># logit splines</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(logit_splines_add_error_rate<span class="sc">$</span>.fitted, logit_splines_add_error_rate<span class="sc">$</span>Y)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>,</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkolivegreen"</span>)</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co"># logit binned</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(logit_binned_error_rate<span class="sc">$</span>.fitted, logit_binned_error_rate<span class="sc">$</span>Y)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>,</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"plum4"</span>)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="co"># CART</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(cart_error_rate<span class="sc">$</span>prob , cart_error_rate<span class="sc">$</span>Y)</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>,</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"dodgerblue"</span>)</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.6</span>,<span class="fl">0.6</span>,</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">'logistic'</span>, <span class="st">'logistic splines'</span>, <span class="st">'logistic binned'</span>, <span class="st">'decision tree'</span>),</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"darkolivegreen"</span>, <span class="st">"plum4"</span>, <span class="st">"dodgerblue"</span>),<span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It can be shown (see for example <a href="https://stats.stackexchange.com/questions/180638/how-to-derive-the-probabilistic-interpretation-of-the-auc">here</a> or <a href="https://www.alexejgossmann.com/auc/">here</a>), that for a score function <span class="math inline">\(S\)</span>:</p>
<p><span class="math inline">\(AUC(S)=\mathbf P(S(X)\geq S(X^{'})|(Y,Y^{'})=(1,0))\)</span> where <span class="math inline">\((X, Y)\)</span>, <span class="math inline">\((X^{'}, Y^{'})\)</span> are independent with law <span class="math inline">\(\mathbf P_{\mathrm X \times \mathrm Y}\)</span></p>
<p>Defining <span class="math inline">\(\mathcal I = \{(i,j)|y_i=1, y_j=0\}\)</span>, we can write an empirical estimator of AUC:</p>
<p><span class="math inline">\(AUC(S)=\frac{1}{Card(\mathcal I)}\sum_{(i,j)\in\mathcal I}\mathbf 1_{S(X_i)&gt;S(S_j)}\)</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>zero <span class="ot">&lt;-</span> logit_error_rate <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Y<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>one <span class="ot">&lt;-</span> logit_error_rate <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Y<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>I_set <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(zero <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score_0 =</span> .fitted) <span class="sc">%&gt;%</span> <span class="fu">select</span>(score_0),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                     one <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score_1 =</span> .fitted) <span class="sc">%&gt;%</span> <span class="fu">select</span>(score_1))</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>P_correctly_classified <span class="ot">&lt;-</span> I_set <span class="sc">%&gt;%</span> </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">correctly_classified =</span> score_1 <span class="sc">&gt;</span> score_0) <span class="sc">%&gt;%</span> </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(correctly_classified) <span class="sc">%&gt;%</span> </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summarize</span>(<span class="at">prob =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(correctly_classified<span class="sc">==</span><span class="cn">TRUE</span>) </span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>(auc_emp <span class="ot">&lt;-</span> P_correctly_classified <span class="sc">%&gt;%</span> <span class="fu">pull</span>(prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.789759</code></pre>
</div>
</div>
<p>This is the same value we obtained with <code>ROCR</code> before using the command <code>performance</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>auc_logit <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>auc_logit <span class="ot">&lt;-</span> auc_logit<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>auc_logit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7822882</code></pre>
</div>
</div>
</section>
<section id="bayes-classifier-exercise-11.9-cornillon2019" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="bayes-classifier-exercise-11.9-cornillon2019"><span class="header-section-number">3.2</span> Bayes classifier (Exercise 11.9 <span class="citation" data-cites="cornillon2019">(<a href="#ref-cornillon2019" role="doc-biblioref">Cornillon and Matzner-Løber 2019</a>)</span>)</h2>
<p>Considering a pair of random variables <span class="math inline">\((X, Y)\)</span> taking values in <span class="math inline">\(\mathbb R\times\{0,1\}\)</span> with:</p>
<p><span class="math inline">\(X\sim\mathcal U[-2,2]\)</span><span class="math inline">\(U\sim\mathcal U[0,10]\)</span></p>
<p>and:</p>
<p><span class="math display">\[
\begin{align*}
Y|X=x  &amp; =\left\{
\begin{array}{ll}
\mathbf 1_{U\leq2}  &amp; \textrm{if } x\leq 0 \\
\mathbf 1_{U&gt;1}  &amp; \textrm{if } x&gt;0
\end{array}\right.
\end{align*}
\]</span> where <span class="math inline">\(\mathcal U[a, b]\)</span> denotes the uniform distribution on <span class="math inline">\([a,b]\)</span> and <span class="math inline">\(X\)</span> and <span class="math inline">\(U\)</span> are assumed to be independent.</p>
<p>Calculate the Bayes classifier and the Bayes risk.</p>
<p>Bayes classifier:</p>
<p>Using the definition of <span class="math inline">\(Y|X\)</span>, if <span class="math inline">\(x \leq 0\)</span> we have <span class="math inline">\(\eta(x) = \mathbb{P}[Y=1|X=x)]= \mathbb{P}[U\leq 2]=\frac{1}{5}\)</span> and if <span class="math inline">\(x&gt;0\)</span> we have <span class="math inline">\(\eta(x) = \mathbb{P}[Y=1|X=x)]=\mathbf P(U&gt; 1)=\frac{9}{10}\)</span>.</p>
<p>Reminding that the Bayes classifier for the 0-1 loss is:</p>
<p><span class="math display">\[
f^*(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } \eta(x)\geq \frac{1}{2}\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span></p>
<p>we have:</p>
<p><span class="math display">\[
f^*(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } x&gt;0\cr
    0 &amp;  \mbox{if } x\leq 0\cr
\end{array} \right.
\]</span> Bayes risk:</p>
<p><span class="math display">\[\begin{align*}
  \mathbb{P}[f^{*}(X)\neq Y|X=x] &amp; = \mathbb{P}[(f^{*}(X)\neq Y|X &gt; 0]\mathbb{P}[X &gt; 0] + \mathbb{P}[(f^{*}(X)\neq Y|X \leq 0]\mathbb{P}[X \leq 0] \\
  &amp; = \mathbb{P}[(Y \neq 1|X &gt; 0]\mathbb{P}[X &gt; 0] + \mathbb{P}[(Y \neq 0|X \leq 0]\mathbb{P}[X \leq 0] \\
  &amp; = \mathbb{P}[(Y = 0|X &gt; 0]\frac{1}{2} + \mathbb{P}[(Y = 1|X \leq 0]\frac{1}{2} \\
  &amp; = (1-\mathbb{P}[(Y = 1|X &gt; 0])\frac{1}{2} + \mathbb{P}[(Y = 1|X \leq 0]\frac{1}{2} \\
  &amp; = (1-\frac{9}{10})\frac{1}{2} + \frac{1}{5}\frac{1}{2} \\
  &amp; = \frac{3}{20} \\
\end{align*}\]</span></p>
</section>
<section id="other-simulated-data-sets" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="other-simulated-data-sets"><span class="header-section-number">3.3</span> Other simulated data sets</h2>
<p>Simulate other toy data sets, and plot decision boundaries for classifiers of your choice. For example:</p>
<ul>
<li>Data set 1:
<ul>
<li><p>Class 0: mixture (ie two buckets a,b chosen randomly with probability <span class="math inline">\(\frac{1}{2}\)</span>) of Gaussian <span class="math inline">\(\mu_{0a}=\begin{bmatrix} 1 \\ 4 \end{bmatrix}\)</span> or <span class="math inline">\(\mu_{0b}=\begin{bmatrix} 1 \\ -4 \end{bmatrix}\)</span> and <span class="math inline">\(\Sigma_{0a}=\Sigma_{0b}=\begin{bmatrix} 2 &amp; 0 \\ 0 &amp; 2 \end{bmatrix}\)</span></p></li>
<li><p>Class 1: Gaussian with <span class="math inline">\(\mu_{1}=\begin{bmatrix} 4 \\ 0 \end{bmatrix}\)</span> and <span class="math inline">\(\Sigma_{1}=\begin{bmatrix} 2 &amp; 0 \\ 0 &amp; 4 \end{bmatrix}\)</span></p></li>
</ul></li>
</ul>
<p>LEFT AS AN EXERCISE TO PREPARE THE EXAM</p>
<ul>
<li><p>Data set 2 (using a “generative” approach, with same assumptions as QDA): Given <span class="math inline">\(\mu_0\)</span>, <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\Sigma_0\)</span> and <span class="math inline">\(\Sigma_1\)</span> and <span class="math inline">\(X\)</span> having values in <span class="math inline">\(\mathbb R^2\)</span>:</p>
<ul>
<li><p><span class="math inline">\(X|Y=0 \sim\mathcal N[\mu_0,\Sigma_0]\)</span>,</p></li>
<li><p><span class="math inline">\(X|Y=1 \sim\mathcal N[\mu_1,\Sigma_1]\)</span> and <span class="math inline">\(\mathbb{P}[Y=1]=\pi\)</span></p></li>
</ul></li>
</ul>
<p>Linear|Quadratic Discriminant Analysis are well described in many books, for example in chapter 4, section 4.3 of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> or <a href="https://rich-d-wilkinson.github.io/MATH3030/8-lda.html#lda">here</a>.</p>
<p>Assuming we model each class (indexed by <span class="math inline">\(k \in \{0, 1\}\)</span>) density as a multivariate Gaussian (in <span class="math inline">\(\mathbb R^{d}\)</span>, here <span class="math inline">\(d=2\)</span>):</p>
<p><span class="math display">\[f_k(x) = \frac{1}{(2 \pi)^{d/2} |\Sigma_k|^{1/2}} \exp \left( - \frac{1}{2} (x - \mu_k)^T \Sigma_k^{-1} (x - \mu_k) \right)\]</span> and knowing <span class="math inline">\(\pi_k = \mathbb{P}[Y=k]\)</span> we have:</p>
<p><span class="math display">\[\mathbb{P}[Y=k|X=x]=\frac{f_k(x)\pi_k}{\mathbb{P}[X=x]}\]</span> Rewriting Bayes Classifier as: <span class="math display">\[
f^*(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } \mathbb{P}[Y=1|X=x]\geq \mathbb{P}[Y=0|X=x]\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span></p>
<p>The condition to predict <span class="math inline">\(f^*(x)=1\)</span> is:</p>
<p><span class="math display">\[\frac{\mathbb{P}[Y=1|X=x]}{\mathbb{P}[Y=0|X=x]}=\frac{f_1(x)\pi_1}{f_0(x)\pi_0}\geq 1\]</span></p>
<p>Or taking the log: <span class="math display">\[\log(\frac{f_1(x)\pi_1}{f_0(x)\pi_0})\geq 0\]</span> We have: <span class="math display">\[\log(f_k(x)\pi_k)=\log f_k(x) + \log \pi_k =C -\frac{1}{2} \log |\Sigma_k| -\frac{1}{2} (x-\mu_k)^T \Sigma_k^{-1} (x-\mu_k)+\log \pi_k \]</span> Usually discriminant functions <span class="math inline">\(\delta_k\)</span> are defined as: <span class="math display">\[\delta_k(x)=-\frac{1}{2} \log |\Sigma_k| -\frac{1}{2} (x-\mu_k)^T \Sigma_k^{-1} (x-\mu_k)+\log \pi_k \]</span> So the Bayes Classifier rewrites: <span class="math display">\[
f^*(x)=\left\{ \begin{array}{ll}
    1 &amp;  \mbox{if } \delta_1(x)\geq \delta_0(x)\cr
    0 &amp;  \mbox{otherwise}\cr
\end{array} \right.
\]</span> The decision boundary is <span class="math inline">\(\{x|\delta_1(x)=\delta_0(x)\}\)</span>. In the most general case (<span class="math inline">\(\Sigma_1 \neq \Sigma_0\)</span>) and for <span class="math inline">\(d=2\)</span> this is the equation of a conic section.</p>
<p>Below we experiment with various choices of <span class="math inline">\(\mu_0,\Sigma_0, \mu_1,\Sigma_1\)</span> and <span class="math inline">\(\pi\)</span> for the <span class="math inline">\(d=2\)</span> case.</p>
<p>We plot the theoretical Bayes decision boundary (a conic, either ellipse, hyperbola or parabola) in purple together with the boundary decision of classifiers estimated on simulated data (LDA in red, QDA in grey, LDA/Logistic Regression with quadratic interactions in green/blue):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 parameters</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>pi_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>mu_11 <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>mu_12 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>sig_11 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>sig_12 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>rho_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 parameters</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>pi_0 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> pi_1  </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>mu_01 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>mu_02 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>sig_01 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">3</span>)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>sig_02 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>rho_0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.3</span> </span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 helpers</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>mu_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_11, mu_12)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>Sigma_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_11 <span class="sc">^</span> <span class="dv">2</span>, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_12 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>det_Sigma_1 <span class="ot">&lt;-</span> sig_11 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_12 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_1 <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>inv_Sigma_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_1 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_12 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_11 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 helpers</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>mu_0 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_01, mu_02)</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>Sigma_0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_01 <span class="sc">^</span> <span class="dv">2</span>, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_02 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>det_Sigma_0  <span class="ot">&lt;-</span> sig_01 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_02 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_0 <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>inv_Sigma_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_0 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_02 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_01 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Conic section</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> sig_12<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">abs</span>(det_Sigma_1)<span class="sc">-</span>sig_12<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">abs</span>(det_Sigma_0) </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span>(rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) )</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> sig_11<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">abs</span>(det_Sigma_1)<span class="sc">-</span>sig_01<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">abs</span>(det_Sigma_0)</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>det_conic <span class="ot">&lt;-</span> B <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> A <span class="sc">*</span> C</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>conic <span class="ot">&lt;-</span> <span class="st">"parabola"</span></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(det_conic<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"hyperbola"</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(det_conic<span class="sc">&lt;</span><span class="dv">0</span>){</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"ellipse"</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>(<span class="fu">paste</span>(<span class="st">"decision boundary is an"</span>,conic))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "decision boundary is an hyperbola"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/74499955/how-to-depict-a-graph-of-an-implicit-differentiation-equation-on-r/74500274#74500274</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Speed up with Rcpp if needed</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/56765690/efficient-way-of-computing-quadratic-forms-for-outer-product-matrices</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>discriminant_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2){</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Boundary decision equation (equalizing the two discriminant equations)</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  delta_1 <span class="ot">&lt;-</span> <span class="fu">log</span>(pi_1) <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">abs</span>(det_Sigma_1)) <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">t</span>(<span class="fu">c</span>(x1 <span class="sc">-</span> mu_11, x2 <span class="sc">-</span> mu_12)) <span class="sc">%*%</span> inv_Sigma_1 <span class="sc">%*%</span> <span class="fu">c</span>(x1 <span class="sc">-</span> mu_11, x2 <span class="sc">-</span> mu_12))  </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  delta_0 <span class="ot">&lt;-</span> <span class="fu">log</span>(pi_0) <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">abs</span>(det_Sigma_0)) <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">t</span>(<span class="fu">c</span>(x1 <span class="sc">-</span> mu_01, x2 <span class="sc">-</span> mu_02)) <span class="sc">%*%</span> inv_Sigma_0 <span class="sc">%*%</span> <span class="fu">c</span>(x1 <span class="sc">-</span> mu_01, x2 <span class="sc">-</span> mu_02)) </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  delta_1 <span class="sc">-</span> delta_0</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>discriminant_boundary_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(discriminant_boundary)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, discriminant_boundary_V)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampling n data from the given distrib</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, pi_1)</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n <span class="sc">-</span> n1</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n1, mu_1, Sigma_1)</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">1</span>, <span class="at">x1 =</span> class_1[,<span class="dv">1</span>], <span class="at">x2 =</span> class_1[,<span class="dv">2</span>])</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0, mu_0, Sigma_0)</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> class_0[,<span class="dv">1</span>], <span class="at">x2 =</span> class_0[,<span class="dv">2</span>])</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict with QDA on a grid</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>class_dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(class_1, class_0) <span class="sc">%&gt;%</span></span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(Y))</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>qda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">qda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>lda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>lda_2nd_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat)</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>logreg_class <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> x, <span class="at">x2 =</span> y) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>qda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(qda_class, density_qda)</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>lda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_class, density_qda)</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>lda_2nd_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_2nd_class, density_qda)</span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>logreg_pred <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(logreg_class, <span class="at">newdata =</span> density_qda, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>qda_fit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">class_qda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(qda_pred<span class="sc">$</span>class)),</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_pred<span class="sc">$</span>class)),</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda_2nd =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_2nd_pred<span class="sc">$</span>class)),</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_logreg_2nd =</span> logreg_pred<span class="sc">$</span>.fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">class_logreg_2nd =</span> <span class="fu">if_else</span>(class_logreg_2nd<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, qda_fit) </span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>oracle_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, <span class="fu">tibble</span>(<span class="at">oracle =</span> <span class="fu">t</span>(<span class="fu">matrix</span>(z, <span class="at">nrow=</span><span class="dv">1</span>))))</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_dat) <span class="sc">+</span></span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour =</span> Y), <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_qda), <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda), <span class="at">col =</span> <span class="st">'darkred'</span>) <span class="sc">+</span></span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda_2nd), <span class="at">col =</span> <span class="st">'darkgreen'</span>) <span class="sc">+</span></span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_logreg_2nd), <span class="at">col =</span> <span class="st">'darkblue'</span>) <span class="sc">+</span></span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> oracle_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> oracle), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">col =</span> <span class="st">'purple'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Slightly changing the centers and variances, here the LDA with quadratic interaction seem to better match the Bayes decision boundary:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 parameters</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>pi_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>mu_11 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>mu_12 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>sig_11 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>sig_12 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>rho_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 parameters</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>pi_0 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> pi_1  </span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>mu_01 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> </span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>mu_02 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>sig_01 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">3</span>)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>sig_02 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>rho_0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.3</span> </span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 helpers</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>mu_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_11, mu_12)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>Sigma_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_11 <span class="sc">^</span> <span class="dv">2</span>, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_12 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>det_Sigma_1 <span class="ot">&lt;-</span> sig_11 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_12 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_1 <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>inv_Sigma_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_1 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_12 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_11 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 helpers</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>mu_0 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_01, mu_02)</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>Sigma_0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_01 <span class="sc">^</span> <span class="dv">2</span>, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_02 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>det_Sigma_0  <span class="ot">&lt;-</span> sig_01 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_02 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_0 <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>inv_Sigma_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_0 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_02 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_01 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Conic section</span></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> sig_12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> sig_12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) </span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span>(rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) )</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> sig_11<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> sig_01<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0)</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>det_conic <span class="ot">&lt;-</span> B <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> A <span class="sc">*</span> C</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>conic <span class="ot">&lt;-</span> <span class="st">"parabola"</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(det_conic<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"hyperbola"</span></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(det_conic<span class="sc">&lt;</span><span class="dv">0</span>){</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"ellipse"</span></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>(<span class="fu">paste</span>(<span class="st">"decision boundary is an"</span>,conic))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "decision boundary is an hyperbola"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boundary decision</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, <span class="fu">Vectorize</span>(discriminant_boundary))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampling n data from the given distrib</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, pi_1)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n <span class="sc">-</span> n1</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n1, mu_1, Sigma_1)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">1</span>, <span class="at">x1 =</span> class_1[,<span class="dv">1</span>], <span class="at">x2 =</span> class_1[,<span class="dv">2</span>])</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0, mu_0, Sigma_0)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> class_0[,<span class="dv">1</span>], <span class="at">x2 =</span> class_0[,<span class="dv">2</span>])</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict with QDA on a grid</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>class_dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(class_1, class_0) <span class="sc">%&gt;%</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(Y))</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>qda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">qda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>lda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>lda_2nd_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>logreg_class <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> x, <span class="at">x2 =</span> y) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>qda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(qda_class, density_qda)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>lda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_class, density_qda)</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>lda_2nd_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_2nd_class, density_qda)</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>logreg_pred <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(logreg_class, <span class="at">newdata =</span> density_qda, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>qda_fit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">class_qda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(qda_pred<span class="sc">$</span>class)),</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_pred<span class="sc">$</span>class)),</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda_2nd =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_2nd_pred<span class="sc">$</span>class)),</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_logreg_2nd =</span> logreg_pred<span class="sc">$</span>.fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">class_logreg_2nd =</span> <span class="fu">if_else</span>(class_logreg_2nd<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, qda_fit) </span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>oracle_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, <span class="fu">tibble</span>(<span class="at">oracle =</span> <span class="fu">t</span>(<span class="fu">matrix</span>(z, <span class="at">nrow=</span><span class="dv">1</span>))))</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_dat) <span class="sc">+</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour =</span> Y), <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_qda), <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda), <span class="at">col =</span> <span class="st">'darkred'</span>) <span class="sc">+</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda_2nd), <span class="at">col =</span> <span class="st">'darkgreen'</span>) <span class="sc">+</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_logreg_2nd), <span class="at">col =</span> <span class="st">'darkblue'</span>) <span class="sc">+</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> oracle_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> oracle), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">col =</span> <span class="st">'purple'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nearly separated classes:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 parameters</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>pi_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>mu_11 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>mu_12 <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>sig_11 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>sig_12 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>rho_1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 parameters</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>pi_0 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> pi_1  </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>mu_01 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span> </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>mu_02 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>sig_01 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>sig_02 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>rho_0 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 helpers</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>mu_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_11, mu_12)</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>Sigma_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_11 <span class="sc">^</span> <span class="dv">2</span>, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_12 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>det_Sigma_1 <span class="ot">&lt;-</span> sig_11 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_12 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_1 <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>inv_Sigma_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_1 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_12 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_11 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 helpers</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>mu_0 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_01, mu_02)</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>Sigma_0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_01 <span class="sc">^</span> <span class="dv">2</span>, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_02 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>det_Sigma_0  <span class="ot">&lt;-</span> sig_01 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_02 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_0 <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>inv_Sigma_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_0 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_02 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_01 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Conic section</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> sig_12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> sig_12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) </span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span>(rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) )</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> sig_11<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> sig_01<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0)</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>det_conic <span class="ot">&lt;-</span> B <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> A <span class="sc">*</span> C</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>conic <span class="ot">&lt;-</span> <span class="st">"parabola"</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(det_conic<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"hyperbola"</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(det_conic<span class="sc">&lt;</span><span class="dv">0</span>){</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"ellipse"</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>(<span class="fu">paste</span>(<span class="st">"decision boundary is an"</span>,conic))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "decision boundary is an ellipse"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boundary decision</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, <span class="fu">Vectorize</span>(discriminant_boundary))</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampling n data from the given distrib</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, pi_1)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n <span class="sc">-</span> n1</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n1, mu_1, Sigma_1)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">1</span>, <span class="at">x1 =</span> class_1[,<span class="dv">1</span>], <span class="at">x2 =</span> class_1[,<span class="dv">2</span>])</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0, mu_0, Sigma_0)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> class_0[,<span class="dv">1</span>], <span class="at">x2 =</span> class_0[,<span class="dv">2</span>])</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict with QDA on a grid</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>class_dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(class_1, class_0) <span class="sc">%&gt;%</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(Y))</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>qda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">qda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>lda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>lda_2nd_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>logreg_class <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> x, <span class="at">x2 =</span> y) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>qda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(qda_class, density_qda)</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>lda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_class, density_qda)</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>lda_2nd_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_2nd_class, density_qda)</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>logreg_pred <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(logreg_class, <span class="at">newdata =</span> density_qda, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>qda_fit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">class_qda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(qda_pred<span class="sc">$</span>class)),</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_pred<span class="sc">$</span>class)),</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda_2nd =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_2nd_pred<span class="sc">$</span>class)),</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_logreg_2nd =</span> logreg_pred<span class="sc">$</span>.fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">class_logreg_2nd =</span> <span class="fu">if_else</span>(class_logreg_2nd<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, qda_fit) </span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>oracle_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, <span class="fu">tibble</span>(<span class="at">oracle =</span> <span class="fu">t</span>(<span class="fu">matrix</span>(z, <span class="at">nrow=</span><span class="dv">1</span>))))</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_dat) <span class="sc">+</span></span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour =</span> Y), <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_qda), <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda), <span class="at">col =</span> <span class="st">'darkred'</span>) <span class="sc">+</span></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda_2nd), <span class="at">col =</span> <span class="st">'darkgreen'</span>) <span class="sc">+</span></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_logreg_2nd), <span class="at">col =</span> <span class="st">'darkblue'</span>) <span class="sc">+</span></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> oracle_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> oracle), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">col =</span> <span class="st">'purple'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Adding imbalance (Prior probability: 80% Class 1)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 parameters</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>pi_1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>mu_11 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>mu_12 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>sig_11 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>sig_12 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>rho_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 parameters</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>pi_0 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> pi_1  </span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>mu_01 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>mu_02 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>sig_01 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">5</span>)</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>sig_02 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">3</span>)</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>rho_0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> </span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 helpers</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>mu_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_11, mu_12)</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>Sigma_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_11 <span class="sc">^</span> <span class="dv">2</span>, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_12 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>det_Sigma_1 <span class="ot">&lt;-</span> sig_11 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_12 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_1 <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>inv_Sigma_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_1 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_12 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_11 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 helpers</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>mu_0 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_01, mu_02)</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>Sigma_0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_01 <span class="sc">^</span> <span class="dv">2</span>, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_02 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>det_Sigma_0  <span class="ot">&lt;-</span> sig_01 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_02 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_0 <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>inv_Sigma_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_0 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_02 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_01 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Conic section</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> sig_12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> sig_12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) </span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span>(rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02 <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0) )</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> sig_11<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_1) <span class="sc">-</span> sig_01<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">abs</span>(det_Sigma_0)</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>det_conic <span class="ot">&lt;-</span> B <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> A <span class="sc">*</span> C</span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>conic <span class="ot">&lt;-</span> <span class="st">"parabola"</span></span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(det_conic<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"hyperbola"</span></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(det_conic<span class="sc">&lt;</span><span class="dv">0</span>){</span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>  conic <span class="ot">&lt;-</span> <span class="st">"ellipse"</span></span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>(<span class="fu">paste</span>(<span class="st">"decision boundary is an"</span>,conic))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "decision boundary is an ellipse"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boundary decision</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, <span class="fu">Vectorize</span>(discriminant_boundary))</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampling n data from the given distrib</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, pi_1)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n <span class="sc">-</span> n1</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n1, mu_1, Sigma_1)</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>class_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">1</span>, <span class="at">x1 =</span> class_1[,<span class="dv">1</span>], <span class="at">x2 =</span> class_1[,<span class="dv">2</span>])</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0, mu_0, Sigma_0)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>class_0 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> class_0[,<span class="dv">1</span>], <span class="at">x2 =</span> class_0[,<span class="dv">2</span>])</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict with QDA on a grid</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>class_dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(class_1, class_0) <span class="sc">%&gt;%</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(Y))</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>qda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">qda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>lda_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>class_dat)</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>lda_2nd_class <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat)</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>logreg_class <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>class_dat, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> x, <span class="at">x2 =</span> y) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>qda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(qda_class, density_qda)</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>lda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_class, density_qda)</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>lda_2nd_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_2nd_class, density_qda)</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>logreg_pred <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(logreg_class, <span class="at">newdata =</span> density_qda, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>qda_fit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">class_qda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(qda_pred<span class="sc">$</span>class)),</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_pred<span class="sc">$</span>class)),</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_lda_2nd =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(lda_2nd_pred<span class="sc">$</span>class)),</span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class_logreg_2nd =</span> logreg_pred<span class="sc">$</span>.fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">class_logreg_2nd =</span> <span class="fu">if_else</span>(class_logreg_2nd<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>density_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, qda_fit) </span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>oracle_qda <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(density_qda, <span class="fu">tibble</span>(<span class="at">oracle =</span> <span class="fu">t</span>(<span class="fu">matrix</span>(z, <span class="at">nrow=</span><span class="dv">1</span>))))</span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(class_dat) <span class="sc">+</span></span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour =</span> Y), <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_qda), <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_contour(data = density_qda, aes(x=x1, y=x2, z = class_lda), col = 'darkred') +</span></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_lda_2nd), <span class="at">col =</span> <span class="st">'darkgreen'</span>) <span class="sc">+</span></span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> density_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> class_logreg_2nd), <span class="at">col =</span> <span class="st">'darkblue'</span>) <span class="sc">+</span></span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> oracle_qda, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z =</span> oracle), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">col =</span> <span class="st">'purple'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Scoring_and_Logistic_Regression_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="references" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-albert1984a" class="csl-entry" role="listitem">
Albert, A., and J. A. Aanderson. 1984. <span>“On the Existence of Maximum Likelihood Estimates in Logistic Regression Models.”</span> <em>Biometrika</em> 71 (1): 1–10. <a href="https://doi.org/10.1093/biomet/71.1.1">https://doi.org/10.1093/biomet/71.1.1</a>.
</div>
<div id="ref-computat2014" class="csl-entry" role="listitem">
Charpentier, Arthur, ed. 2014. <em>Computational Actuarial Science with r</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/b17230">https://doi.org/10.1201/b17230</a>.
</div>
<div id="ref-cornillon2019" class="csl-entry" role="listitem">
Cornillon, Pierre-André, and Eric Matzner-Løber. 2019. <em>Régression Avec r, 2e Édition</em>. Springer Paris. <a href="https://doi.org/10.1007/978-2-8178-0184-1">https://doi.org/10.1007/978-2-8178-0184-1</a>.
</div>
<div id="ref-desbois2008" class="csl-entry" role="listitem">
Desbois, Dominique. 2008. <span>“<span class="nocase">Introduction to scoring methods: financial problems of farm holdings</span>.”</span> Edited by Société française de Statistique. <em><span>Case Studies in Business, Industry and Government Statistics</span></em> 2 (1): 56–76. <a href="https://hal.science/hal-01172847">https://hal.science/hal-01172847</a>.
</div>
<div id="ref-hastie2009" class="csl-entry" role="listitem">
Hastie, T., R. Tibshirani, and J. Friedman. 2009. <em>The Elements of Statistical Learning</em>. Springer New York. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>.
</div>
<div id="ref-hosmer2013" class="csl-entry" role="listitem">
Hosmer, David W., Stanley Lemeshow, and Rodney X. Sturdivant. 2013. <em>Applied Logistic Regression</em>. <em>Wiley Series in Probability and Statistics</em>. <a href="https://doi.org/10.1002/9781118548387">https://doi.org/10.1002/9781118548387</a>.
</div>
<div id="ref-islr2021" class="csl-entry" role="listitem">
James, G., D. Witten, T. Hastie, and R. Tibshirani. 2021. <em>An Introduction to Statistical Learning: With Applications in r</em>. Springer Texts in Statistics. Springer US. <a href="https://doi.org/10.1007/978-1-0716-1418">https://doi.org/10.1007/978-1-0716-1418</a>.
</div>
<div id="ref-nelder1972" class="csl-entry" role="listitem">
Nelder, J. A., and R. W. M. Wedderburn. 1972. <span>“Generalized Linear Models.”</span> <em>Journal of the Royal Statistical Society. Series A (General)</em> 135 (3): 370. <a href="https://doi.org/10.2307/2344614">https://doi.org/10.2307/2344614</a>.
</div>
<div id="ref-scoringThomas" class="csl-entry" role="listitem">
Thomas, L., D. Edelman, and J. Crook. 2002. <em>Credit Scoring and Its Applications</em>. <em>Monographs on Mathematical Modeling &amp; Computation</em>.
</div>
<div id="ref-tufféry2011" class="csl-entry" role="listitem">
Tufféry, Stéphane. 2011. <em>Data Mining and Statistics for Decision Making</em>. <a href="https://doi.org/10.1002/9780470979174">https://doi.org/10.1002/9780470979174</a>.
</div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>In statistics, inputs are often called the predictors, factors or the independent variables. In machine learning the term features is also used.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The outputs are also called responses, labels or dependent variables.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Here I use a high level explanation which is very elegantly detailed in Sébastien Gadat - TSE - Maths of Deep and Machine Learning course <a href="https://perso.math.univ-toulouse.fr/gadat/files/2012/12/Note-25-oct.-2022.pdf">here</a>; Other good references are Philippe Rigollet - MIT - 18.657: Mathematics of Machine Learning <a href="https://ocw.mit.edu/courses/18-657-mathematics-of-machine-learning-fall-2015/81406c87dccb9e873cfafa876a4d69c3_MIT18_657F15_LecNote.pdf">here</a> or Erwan Le Pennec - Polytechnique - Introduction to Machine Learning (M2 MSV) <a href="http://www.cmap.polytechnique.fr/~lepennec/files/MSV/MLMethods_Adv%20-%20MSV%20-%2023.pdf">slides here</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>